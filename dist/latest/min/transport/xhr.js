(function(t,e){"use strict";function n(){return e.qoopido.initialize("transport/xhr",t,arguments,!0)}"function"==typeof define&&define.amd?define(["../transport","../function/merge","../function/unique/uuid","../url","q"],n):n()})(function(t,e,n,r){"use strict";function i(t,e,n){var r,i=this,c=i.xhr,f=i.settings;n="object"==typeof n?i.serialize(n):n,e=f.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=n&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",n):e;for(r in f.xhrOptions)c[r]=f.xhrOptions[r];c.open(t,e,f.async,f.username,f.password),c.setRequestHeader("Accept",f.accept),n&&"GET"!==t&&c.setRequestHeader("Content-Type",f.contentType);for(r in f.header)c.setRequestHeader(r,f.header[r]);c.timeout=f.timeout,c.onprogress=function(t){o.call(i,t)},c.onreadystatechange=function(){u.call(i)},c.onerror=function(){s.call(i)},c.send(n||null),i.timeout=setTimeout(function(){a(c)},f.timeout)}function o(t){this.dfd.notify(t)}function u(){var t=this,e=t.xhr,n=t.dfd;4===e.readyState&&(c.call(t),200===e.status?n.resolve({data:e.responseText,xhr:e}):n.reject({status:e.status,xhr:e}))}function s(){var t=this;c.call(t),t.dfd.reject()}function a(t){t.abort()}function c(){var t=this,e=t.xhr;clearTimeout(t.timeout),e.onprogress=e.onreadystatechange=e.onerror=null}var f,l=r.Q||e[4],d=r.XMLHttpRequest!==undefined?function(e){return t.url.isLocal(e)?new r.XMLHttpRequest:r.XDomainRequest?new r.XDomainRequest:new r.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return f=t.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(e,n,r,o){var u={};return n=t.url.resolve(n),u.id="".concat("xhr-",t["function/unique/string"]()),u.dfd=l.defer(),u.xhr=d(n),u.settings=t["function/merge"]({},this._settings,o),u.timeout=null,i.call(u,e.toUpperCase(),n,r),u.dfd.promise},get:function(t,e,n){return this.load("GET",t,e,n)},post:function(t,e,n){return this.load("POST",t,e,n)},put:function(t,e,n){return this.load("PUT",t,e,n)},"delete":function(t,e,n){return this.load("DELETE",t,e,n)},head:function(t,e,n){return this.load("HEAD",t,e,n)}})},window,document);