(function(e,t){"use strict";function n(){return t.qoopido.initialize("pool",e,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/unique/uuid"],n):n()})(function(e){"use strict";function t(){var e,t,n,i,r,o=this,u=o.metrics,s=o._settings,a=o._queue,c=o._variables,l=1;if(a.length>0&&(c.durationAverage>0&&(l=~~(1>(l=s.frameBudget/c.durationAverage)?1:l)),(e=(t=a.splice(0,l)).length)>0))if(u.inPool+e<=s.maxPoolsize){for(r=(new Date).getTime(),n=0,i=t[n];e>n;n++){var f=i._quid,d=i.dispose;i=o._dispose(i),i._quid=f,i.dispose=d,o._getPool.call(o,i).push(i)}u.inPool+=e,u.inQueue-=e,c.durationSamples+=e,c.durationTotal+=(new Date).getTime()-r,c.durationAverage=c.durationTotal/c.durationSamples}else t=a.splice(0,~~(a.length*s.queueFactor)),u.inQueue-=e+t.length,u.destroyed+=e+t.length,t.length=0}var n,i={interval:15,frameBudget:.5,maxPoolsize:1e3,queueFactor:.2};return n=e.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var r=this;r.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},r._settings=e["function/merge"]({},i,n),r._pool=r._initPool(),r._queue=[],r._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){t.call(r)},r._settings.interval)},_initPool:function(){return[]},_getPool:function(){return this._pool},obtain:function(){var t=this,n=t._getPool.apply(t,arguments).pop();return n?(t.metrics.inPool--,t.metrics.recycled++):(n=t._obtain.apply(t,arguments),n._quid=e["function/unique/uuid"](),n.dispose=function(){t.dispose(n)},t.metrics.total++),t.metrics.inUse++,n},dispose:function(t){var n=this,i=n._queue;return t._quid||(t._quid=e["function/unique/uuid"](),t.dispose=function(){n.dispose(t)},n.metrics.total++,n.metrics.inUse++),i.length<n._settings.maxPoolsize?(i.push(t),n.metrics.inUse--,n.metrics.inQueue++):(n.metrics.inUse--,n.metrics.destroyed++),null}})},window);