(function(t){window.qoopido.registerSingleton("transport/jsonp",t,["../transport","../function/merge","../function/unique/uuid","../url","../dom/element","../pool/dom","q"])})(function(t,e,o,r,n){"use strict";function i(t,e){var o=this,n=o.dfd,i=o.script,l=o.settings;e="object"==typeof e?o.serialize(e):e,t="".concat(t,t.indexOf("?")>-1?"&":"?","".concat(l.callback,"=",o.id)),t=l.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","".concat("_=",""+(new Date).getTime())):t,t=e?"".concat(t,t.indexOf("?")>-1?"&":"?",e):t,r[o.id]=function(t){try{delete r[o.id]}catch(e){r[o.id]=null}c.call(o),n.resolve(t)},i.on("load readystatechange",function(t){s.call(o,t)}).one("error",function(){u.call(o)}).setAttribute("src",t),d.appendChild(i.element),o.timeout=setTimeout(function(){a.call(o)},l.timeout)}function s(t){var e=this,o=e.dfd;t.readyState&&"loaded"!==t.readyState&&"complete"!==t.readyState||e.script.off().element.dispose(),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){a.call(e)},e.settings.timeout),o.notify(t)}function u(){var t=this;c.call(t),t.dfd.reject()}function a(){var t=this;c.call(t),t.dfd.reject(!1)}function c(){var t=this;t.timeout&&clearTimeout(t.timeout),t.script.off().element.dispose()}var l,p=t.q||r.Q,d=n.getElementsByTagName("head")[0];return l=t.transport.extend({_settings:{callback:"callback",cache:!1,timeout:5e3},load:function(e,o,n){var s={};return e=t.url.resolve(e),s.id="".concat("jsonp-",t["function/unique/string"]()),s.dfd=p.defer(),s.script=t["dom/element"].create(r.qoopido.shared.pool.dom.obtain("script")),s.settings=t["function/merge"]({},this._settings,n),s.timeout=null,s.script.setAttribute("async",!0),i.call(s,e,o),s.dfd.promise}})},window,document);