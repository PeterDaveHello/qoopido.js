(function(e,t){"use strict";function n(){return t.qoopido.shared.module.initialize("element/emerge",e)}"function"==typeof define&&define.amd?define(["../element","../function/merge","../unique"],n):n()})(function(e,t,n,r,o){"use strict";function i(e){var t,r=v[e];for(t in r)"length"!==t&&c.call(r[t]);0===r.length&&(n.element.clearInterval(y[e]),delete y[e])}function l(){d.left=0,d.top=0,d.right=p.clientWidth,d.bottom=p.clientHeight}function u(){var e=this,t=e._settings.threshold||p.clientWidth*e._settings.auto,n=e._settings.threshold||p.clientHeight*e._settings.auto;e._viewport.left=d.left-t,e._viewport.top=d.top-n,e._viewport.right=d.right+t,e._viewport.bottom=d.bottom+n}function c(){var e,t=this,n=!1,r=2;!t.isVisible()||"hidden"===t.getStyle("visibility")&&t._settings.visibility!==!1||(e=t.element.getBoundingClientRect(),(e.left>=t._viewport.left&&e.top>=t._viewport.top&&e.left<=t._viewport.right&&e.top<=t._viewport.bottom||e.right>=t._viewport.left&&e.bottom>=t._viewport.top&&e.right<=t._viewport.right&&e.bottom<=t._viewport.bottom)&&((e.left>=d.left&&e.top>=d.top&&e.left<=d.right&&e.top<=d.bottom||e.right>=d.left&&e.bottom>=d.top&&e.right<=d.right&&e.bottom<=d.bottom)&&(r=1),n=!0)),(n!==t._state||n===!0&&r!==t._priority)&&s.call(t,n,r)}function s(e,t){var n=this;n._state=e,n._priority=t,n._settings.recur!==!0&&n.remove(),e===!0?n.emit(h,t):n.emit(_)}var f,a={interval:50,threshold:"auto",recur:!0,auto:.5,visibility:!0},p=n.document.documentElement,d={},y={},v={},h="emerged",_="demerged",m="resize orientationchange";if(n=e.element.create(n),"CSS1Compat"!==r.compatMode)throw"This script requires your browser to work in standards mode";return f=e.element.extend({_viewport:null,_uuid:null,_element:null,_settings:null,_state:null,_priority:null,_constructor:function(t,r){var l=this;f._parent._constructor.call(l,t),r=e.function.merge({},a,r||{}),"auto"===r.threshold&&delete r.threshold,y[r.interval]===o&&(v[r.interval]=v[r.interval]||{length:0},y[r.interval]=n.element.setInterval(function(){i(r.interval)},r.interval)),l._viewport={},l._uuid=e.unique.uuid(),l._settings=r,l._state=!1,l._priority=2,v[r.interval][l._uuid]=l,v[r.interval].length++,n.on(m,function(){u.call(l)}),u.call(l)},remove:function(){var e=this;delete v[e._settings.interval][e._uuid],v[e._settings.interval].length--}}),n.on(m,l),l(),f},window);