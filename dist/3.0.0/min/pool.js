(function(t,e){"use strict";function n(){return e.qoopido.initialize("pool",t,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/unique/uuid"],n):n()})(function(t){"use strict";function e(){var t,e,n,i,r,o=this,u=o.metrics,s=o._settings,a=o._queue,c=o._variables,l=1;if(a.length>0&&(c.durationAverage>0&&(l=~~(1>(l=s.frameBudget/c.durationAverage)?1:l)),(t=(e=a.splice(0,l)).length)>0))if(u.inPool+t<=s.maxPoolsize){for(r=(new Date).getTime(),n=0,i=e[n];t>n;n++)o._getPool.call(o,i).push(o._dispose(i));u.inPool+=t,u.inQueue-=t,c.durationSamples+=t,c.durationTotal+=(new Date).getTime()-r,c.durationAverage=c.durationTotal/c.durationSamples}else e=a.splice(0,~~(a.length*s.queueFactor)),u.inQueue-=t+e.length,u.destroyed+=t+e.length,e.length=0}var n,i={interval:15,frameBudget:.5,maxPoolsize:1e3,queueFactor:.2};return n=t.base.extend({metrics:{total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},_settings:null,_pool:null,_queue:[],_variables:{durationSamples:0,durationTotal:0,durationAverage:0},_constructor:function(n){var r=this;r._settings=t["function/merge"]({},i,n),r._pool=r._initPool(),setInterval(function(){e.call(r)},r._settings.interval)},_initPool:function(){return[]},_getPool:function(){return this._pool},obtain:function(){var e=this,n=e._getPool.apply(e,arguments).pop();return n?(e.metrics.inPool--,e.metrics.recycled++):(n=e._obtain.apply(e,arguments),e.metrics.total++),e.metrics.inUse++,n._quid=t["function/unique/uuid"](),n},dispose:function(e){var n=this,i=n._queue;return e._quid||(e._quid=t["function/unique/uuid"](),n.metrics.total++,n.metrics.inUse++),i.length<n._settings.maxPoolsize?(i.push(e),n.metrics.inUse--,n.metrics.inQueue++):(n.metrics.inUse--,n.metrics.destroyed++),null}})},window);