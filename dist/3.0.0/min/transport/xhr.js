(function(e,t){"use strict";function n(){return t.qoopido.shared.module.initialize("transport/xhr",e,arguments,!0)}"function"==typeof define&&define.amd?define(["../transport","../function/merge","../url","../unique","q"],n):n()})(function(e,t,n,r){"use strict";function i(e,t,n){var r,i=this,c=i.xhr,l=i.settings;n="object"==typeof n?i.serialize(n):n,t=l.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):t,t=n&&"GET"===e?"".concat(t,t.indexOf("?")>-1?"&":"?",n):t;for(r in l.xhrOptions)c[r]=l.xhrOptions[r];c.open(e,t,l.async,l.username,l.password),c.setRequestHeader("Accept",l.accept),n&&"GET"!==e&&c.setRequestHeader("Content-Type",l.contentType);for(r in l.header)c.setRequestHeader(r,l.header[r]);c.timeout=l.timeout,c.onprogress=function(e){o.call(i,e)},c.onreadystatechange=function(){u.call(i)},c.onerror=function(){s.call(i)},c.send(n||null),i.timeout=setTimeout(function(){a(c)},l.timeout)}function o(e){this.dfd.notify(e)}function u(){var e=this,t=e.xhr,n=e.dfd;4===t.readyState&&(c.call(e),200===t.status?n.resolve({data:t.responseText,xhr:t}):n.reject({status:t.status,xhr:t}))}function s(){var e=this;c.call(e),e.dfd.reject()}function a(e){e.abort()}function c(){var e=this,t=e.xhr;clearTimeout(e.timeout),t.onprogress=t.onreadystatechange=t.onerror=null}var l,f=r.Q||t[4],d=r.XMLHttpRequest!==undefined?function(t){return e.url.isLocal(t)?new r.XMLHttpRequest:r.XDomainRequest?new r.XDomainRequest:new r.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return null}};return l=e.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(t,n,r,o){var u={};return n=e.url.resolve(n),u.id="".concat("xhr-",e.unique.string()),u.dfd=f.defer(),u.xhr=d(n),u.settings=e.function.merge({},this._settings,o),u.timeout=null,i.call(u,t.toUpperCase(),n,r),u.dfd.promise},get:function(e,t,n){return this.load("GET",e,t,n)},post:function(e,t,n){return this.load("POST",e,t,n)},put:function(e,t,n){return this.load("PUT",e,t,n)},"delete":function(e,t,n){return this.load("DELETE",e,t,n)},head:function(e,t,n){return this.load("HEAD",e,t,n)}})},window,document);