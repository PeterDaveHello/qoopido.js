(function(e,t){"use strict";var n=function n(){return t.qoopido.shared.module.initialize("transport/xhr",e,arguments,!0)};"function"==typeof define&&define.amd?define(["../base","../url","../unique","q"],n):n(t.qoopido.base,t.qoopido.url,t.qoopido.unique,t.Q)})(function(e,t,n,r,o,i){"use strict";function u(e){if("object"==typeof e){var t;for(t in e)h[t]!==undefined&&(h[t]=e[t])}}function s(e){var t,n=this;e="object"==typeof e?e:{};for(t in h)n.settings[t]=e[t]||h[t]}function a(e,t,n){var r,o=this,i=o.xhr,u=o.settings;n="object"==typeof n?p(n):n,t=u.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):t,t=n&&"GET"===e?"".concat(t,t.indexOf("?")>-1?"&":"?",n):t;for(r in u.xhrOptions)i[r]=u.xhrOptions[r];i.open(e,t,u.async,u.username,u.password),i.setRequestHeader("Accept",u.accept),n&&"GET"!==e&&i.setRequestHeader("Content-Type",u.contentType);for(r in u.header)i.setRequestHeader(r,u.header[r]);i.timeout=u.timeout,i.onprogress=function(e){l.call(o,e)},i.onreadystatechange=function(){f.call(o)},i.onerror=function(){d.call(o)},i.send(n||null),o.timeout=setTimeout(function(){c(i)},u.timeout)}function c(e){e.abort()}function l(e){this.dfd.notify(e.loaded/e.total)}function f(){var e=this,t=e.xhr,n=e.dfd;4===t.readyState&&(clearTimeout(e.timeout),200===t.status?n.resolve({data:t.responseText,xhr:t}):n.reject({status:t.status,xhr:t}))}function d(){var e=this;clearTimeout(e.timeout),e.dfd.reject()}function p(e,t){var n,r,o,i=[];for(n in e)r=t?"".concat(t,"[",n,"]"):n,o=e[n],i.push("object"==typeof o?p(o,r):"".concat(encodeURIComponent(r),"=",encodeURIComponent(o)));return i.join("&")}var m,h={accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},g=i.XMLHttpRequest!==undefined?function(e){return t.isLocal(e)?new i.XMLHttpRequest:i.XDomainRequest?new i.XDomainRequest:new i.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return null}};return m=e.extend({setup:function(e){return u(e),this},load:function(e,o,i,u){var c={};return o=t.resolve(o),c.id=n.string(),c.dfd=r.defer(),c.xhr=g(o),c.timeout=null,c.settings={},s.apply(c,[u]),a.apply(c,[e.toUpperCase(),o,i]),c.dfd.promise},get:function(e,t,n){return this.load("GET",e,t,n)},post:function(e,t,n){return this.load("POST",e,t,n)},put:function(e,t,n){return this.load("PUT",e,t,n)},"delete":function(e,t,n){return this.load("DELETE",e,t,n)},head:function(e,t,n){return this.load("HEAD",e,t,n)}})},window,document);