(function(t,e){"use strict";var n=function n(){return e.qoopido.shared.module.initialize("transport/xhr",t,arguments,!0)};"function"==typeof define&&define.amd?define(["../base","../url","../unique","q"],n):n(e.qoopido.base,e.qoopido.url,e.qoopido.unique,e.Q)})(function(t,e,n,r,o,i){"use strict";function u(t){if("object"==typeof t){var e;for(e in t)h[e]!==undefined&&(h[e]=t[e])}}function s(t){var e,n=this;t="object"==typeof t?t:{};for(e in h)n.settings[e]=t[e]||h[e]}function a(t,e,n){var r,o=this,i=o.xhr,u=o.settings;n="object"==typeof n?p(n):n,e=u.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=n&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",n):e;for(r in u.xhrOptions)i[r]=u.xhrOptions[r];i.open(t,e,u.async,u.username,u.password),i.setRequestHeader("Accept",u.accept),n&&"GET"!==t&&i.setRequestHeader("Content-Type",u.contentType);for(r in u.header)i.setRequestHeader(r,u.header[r]);i.timeout=u.timeout,i.onprogress=function(t){l.call(o,t)},i.onreadystatechange=function(){f.call(o)},i.onerror=function(){d.call(o)},i.send(n||null),o.timeout=setTimeout(function(){c(i)},u.timeout)}function c(t){t.abort()}function l(t){this.dfd.notify(t.loaded/t.total)}function f(){var t=this,e=t.xhr,n=t.dfd;4===e.readyState&&(clearTimeout(t.timeout),200===e.status?n.resolve({data:e.responseText,xhr:e}):n.reject({status:e.status,xhr:e}))}function d(){var t=this;clearTimeout(t.timeout),t.dfd.reject()}function p(t,e){var n,r,o,i=[];for(n in t)r=e?"".concat(e,"[",n,"]"):n,o=t[n],i.push("object"==typeof o?p(o,r):"".concat(encodeURIComponent(r),"=",encodeURIComponent(o)));return i.join("&")}var m,h={accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},g=i.XMLHttpRequest!==undefined?function(t){return e.isLocal(t)?new i.XMLHttpRequest:i.XDomainRequest?new i.XDomainRequest:new i.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return m=t.extend({setup:function(t){return u(t),this},load:function(t,o,i,u){var c={};return o=e.resolve(o),c.id=n.string(),c.dfd=r.defer(),c.xhr=g(o),c.timeout=null,c.settings={},s.apply(c,[u]),a.apply(c,[t.toUpperCase(),o,i]),c.dfd.promise},get:function(t,e,n){return this.load("GET",t,e,n)},post:function(t,e,n){return this.load("POST",t,e,n)},put:function(t,e,n){return this.load("PUT",t,e,n)},"delete":function(t,e,n){return this.load("DELETE",t,e,n)},head:function(t,e,n){return this.load("HEAD",t,e,n)}})},window,document);