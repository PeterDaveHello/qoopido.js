/*!
* Qoopido.js library package
*
* version: 3.1.5
* date:    2013-12-06
* author:  Dirk Lueth <info@qoopido.com>
* website: https://github.com/dlueth/qoopido.js
*
* Copyright (c) 2013 Dirk Lueth
*
* Dual licensed under the MIT and GPL licenses.
*  - http://www.opensource.org/licenses/mit-license.php
*  - http://www.gnu.org/copyleft/gpl.html
*/
(function(t){var e=window.qoopido=window.qoopido||{};e.register?e.register("polyfill/object/defineproperty",t):(window.qoopido.modules=window.qoopido.modules||{})["polyfill/object/defineproperty"]=t()})(function(){"use strict";if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()){var t=Object.defineProperty,e=Object.prototype.__defineGetter__,n=Object.prototype.__defineSetter__;Object.defineProperty=function(r,i,o){if(t)try{return t(r,i,o)}catch(l){}if(r!==Object(r))throw new TypeError("Object.defineProperty called on non-object");return e&&"get"in o&&e.call(r,i,o.get),n&&"set"in o&&n.call(r,i,o.set),"value"in o&&(r[i]=o.value),r}}return!0});
(function(t){var e=window.qoopido=window.qoopido||{};if(e.register){var n=[];Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()||n.push("./defineproperty"),e.register("polyfill/object/defineproperties",t,n)}else(window.qoopido.modules=window.qoopido.modules||{})["polyfill/object/defineproperties"]=t()})(function(){"use strict";return Object.defineProperties||(Object.defineProperties=function(t,e){if(t!==Object(t))throw new TypeError("Object.defineProperties called on non-object");var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(t,n,e[n]);return t}),!0});
(function(t){var e=window.qoopido=window.qoopido||{};if(e.register){var n=[];Object.defineProperties||n.push("./defineproperties"),e.register("polyfill/object/create",t,n)}else(window.qoopido.modules=window.qoopido.modules||{})["polyfill/object/create"]=t()})(function(){"use strict";return Object.create||(Object.create=function(t,e){function n(){}if("object"!=typeof t)throw new TypeError;n.prototype=t;var r=new n;if(t&&(r.constructor=n),arguments.length>1){if(e!==Object(e))throw new TypeError;Object.defineProperties(r,e)}return r}),!0});
(function(t){var e=window.qoopido=window.qoopido||{};e.register?e.register("polyfill/object/getownpropertynames",t):(window.qoopido.modules=window.qoopido.modules||{})["polyfill/object/getownpropertynames"]=t()})(function(){"use strict";return Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){if(t!==Object(t))throw new TypeError("Object.getOwnPropertyNames called on non-object");var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(e);return n}),!0});
(function(t){var e=window.qoopido=window.qoopido||{};e.register?e.register("polyfill/object/getownpropertydescriptor",t):(window.qoopido.modules=window.qoopido.modules||{})["polyfill/object/getownpropertydescriptor"]=t()})(function(){"use strict";if(!Object.getOwnPropertyDescriptor||!function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(t){return!1}}()){var t=Object.getOwnPropertyDescriptor;Object.getOwnPropertyDescriptor=function(e,n){if(e!==Object(e))throw new TypeError;try{return t.call(Object,e,n)}catch(r){}return Object.prototype.hasOwnProperty.call(e,n)?{value:e[n],enumerable:!0,writable:!0,configurable:!0}:undefined}}return!0});
(function(e,t,r,n,o){"use strict";function c(e,c,i,u){var p,d=e.split("/");return f[e]?f[e]:(p=function(){if(i){var p,g,y,j=d.slice(0,-1).join("/");for(p=0;(g=i[p])!==o;p++)y=l.test(g),y&&(g=s(j+"/"+g)),!f[g]&&arguments[p]&&(f[g]=arguments[p]),y&&!f[g]&&"undefined"!=typeof console&&console.error("".concat("[Qoopido.js] ",e,": Could not load dependency ",g))}return f[e]=c(f,a,d,t,r,n,o),u&&u(f[e]),f[e]},"function"==typeof define&&define.amd?i?define(i,p):define(p):p(),o)}function i(e,t,r){c(e,t,r,function(t){f[e]=t.create()})}function s(e){for(var t;(t=e.replace(g,""))!==e;)e=t;return e.replace(y,"")}var u="qoopido",p=r[u]=r[u]||{},a=p.shared=p.shared||{},f=p.modules=p.modules||{},d=[],l=RegExp("^\\.+\\/"),g=RegExp("(?:\\/|)[^\\/]*\\/\\.\\."),y=RegExp("(^\\/)|\\.\\/","g");p.register=c,p.registerSingleton=i,Object.create||d.push("./polyfill/object/create"),Object.getOwnPropertyNames||d.push("./polyfill/object/getownpropertynames"),Object.getOwnPropertyDescriptor&&function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(e){return!1}}()||d.push("./polyfill/object/getownpropertydescriptor"),c("base",e,d)})(function(e,t,r,n,o,c,i){"use strict";function s(e){var t,r,n={},o=Object.getOwnPropertyNames(e);for(t=0;(r=o[t])!==i;t++)n[r]=Object.getOwnPropertyDescriptor(e,r);return n}return{create:function(){var e,t=Object.create(this,s(this));return t._constructor&&(e=t._constructor.apply(t,arguments)),t.create=t.extend=i,e||t},extend:function(e){return e=e||{},e._parent=this,Object.create(this,s(e))}}},navigator,window,document);
(function(t){window.qoopido.register("polyfill/window/getcomputedstyle",t)})(function(t,e,n,r,o){"use strict";if(!o.getComputedStyle){var i=RegExp("(\\-([a-z]){1})","g"),l=function(){return arguments[2].toUpperCase()};o.getComputedStyle=function(t){var e=this;return e.element=t,e.getPropertyValue=function(e){return"float"===e&&(e="styleFloat"),i.test(e)&&(e=e.replace(i,l)),t.currentStyle[e]?t.currentStyle[e]:null},e}}return!0});
(function(t){window.qoopido.register("function/unique/uuid",t)})(function(){"use strict";function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,function(t){var e=0|16*Math.random(),n="x"===t?e:8|3&e;return n.toString(16)})}var e={},n=RegExp("[xy]","g");return function(){var n;do n=t();while(e[n]!==undefined);return e[n]=!0,n}});
(function(t){window.qoopido.register("proxy",t,["./function/unique/uuid"])})(function(t){"use strict";return t.base.extend({_constructor:function(e,n){var r=Array.prototype.splice.call(arguments,2),o=function(){return n.apply(e,Array.prototype.slice.call(arguments,0).concat(r))};return o._quid=t["function/unique/uuid"](),o}})});
(function(t){var e=["../proxy"];window.getComputedStyle||e.push("../polyfill/window/getcomputedstyle"),window.qoopido.register("dom/element",t,e)})(function(t,e,n,r,i,o,a){"use strict";function s(t){return t.target||(t.target=t.srcElement||o),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t}var l,u,c,f="object",p="string";return l=i.addEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r[i]=function(t){e.call(this,s(t))},r.addEventListener(t,r[i],!1)}:function(t,e){var n=this,r=n.element,o="".concat("listener[",t,"][",e._quid||e,"]");r[o]=function(){e.call(this,s(i.event))},r["on"+t]!==a?r.attachEvent("on"+t,r[o]):(t="".concat("fake[",t,"]"),r[t]=null,r.attachEvent("onpropertychange",function(n){n.propertyName===t&&e.call(this,s(r[t]))}))},u=i.removeEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.removeEventListener(t,r[i],!1),delete r[i]}:function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.detachEvent("on"+t,r[i]),delete r[i]},c=o.createEvent?function(t,e){var n=this,r=n.element,i=o.createEvent("HTMLEvents");i.initEvent(t,!0,!0),i.data=e,r.dispatchEvent(i)}:function(t,e){var n=this,r=n.element,i=o.createEventObject();i.type=i.eventType=t,i.data=e;try{r.fireEvent("on"+i.eventType,i)}catch(s){var l="".concat("fake[",t,"]");r[l]!==a&&(r[l]=i)}},t.base.extend({type:null,element:null,listener:null,_constructor:function(t){var e=this;if(!t)throw Error("Missing element argument");e.type=t.tagName,e.element=t,e.listener={}},getAttribute:function(t){if(t&&typeof t===p){var e=this;return t=t.split(" "),1===t.length?e.element.getAttribute(t[0]):e.getAttributes(t)}},getAttributes:function(t){var e=this,n={};if(t&&(t=typeof t===p?t.split(" "):t,typeof t===f&&t.length)){var r,i;for(r=0;(i=t[r])!==a;r++)n[i]=e.element.getAttributes(i)}return n},setAttribute:function(t,e){var n=this;return t&&typeof t===p&&n.element.setAttribute(t,e),n},setAttributes:function(t){var e=this;if(t&&typeof t===f&&!t.length){var n;for(n in t)e.element.setAttribute(n,t[n])}return e},removeAttribute:function(t){var e=this;return t&&typeof t===p&&(t=t.split(" "),1===t.length?e.element.removeAttribute(t[0]):e.removeAttributes(t)),e},removeAttributes:function(t){var e=this;if(t&&(t=typeof t===p?t.split(" "):t,typeof t===f&&t.length)){var n,r;for(n=0;(r=t[n])!==a;n++)e.element.removeAttribute(r)}return e},getStyle:function(t){if(t&&typeof t===p){var e=this;return t=t.split(" "),1===t.length?i.getComputedStyle(e.element,null).getPropertyValue(t[0]):e.getStyles(t)}},getStyles:function(t){var e=this,n={};if(t&&(t=typeof t===p?t.split(" "):t,typeof t===f&&t.length)){var r,o;for(r=0;(o=t[r])!==a;r++)n[o]=i.getComputedStyle(e.element,null).getPropertyValue(o)}return n},setStyle:function(t,e){var n=this;return t&&typeof t===p&&(n.element.style[t]=e),n},setStyles:function(t){var e=this;if(t&&typeof t===f&&!t.length){var n;for(n in t)e.element.style[n]=t[n]}return e},isVisible:function(){var t=this.element;return!(0>=t.offsetWidth&&0>=t.offsetHeight)},on:function(t,e){var n,r,i=this;for(t=t.split(" "),n=0;(r=t[n])!==a;n++)(i.listener[r]=i.listener[r]||[]).push(e),l.call(i,r,e);return i},one:function(e,n,r){r=r!==!1;var i=this,o=t.proxy.create(i,function(t){i.off(r===!0?t.type:e,o),n.call(i,t)});return i.on(e,o),i},off:function(t,e){var n,r,i,o,s=this;if(t)for(t=t.split(" "),n=0;(r=t[n])!==a;n++)if(s.listener[r]=s.listener[r]||[],e)for(i=0;(o=s.listener[r][i])!==a;i++)o===e&&(s.listener[r].splice(i,1),u.call(s,r,o),i--);else for(;s.listener[r].length>0;)u.call(s,r,s.listener[r].pop());else for(r in s.listener)for(;s.listener[r].length>0;)u.call(s,r,s.listener[r].pop());return s},emit:function(t,e){var n=this;return c.call(n,t,e),n}})});
(function(t){window.qoopido.register("function/merge",t)})(function(t,e,n,r,i,o,a){"use strict";return function l(){var t,e,n,r,i,o=arguments[0];for(t=1;(e=arguments[t])!==a;t++)for(n in e)r=o[n],i=e[n],i!==a&&(null!==i&&"object"==typeof i?(r=i.length!==a?r&&"object"==typeof r&&r.length!==a?r:[]:r&&"object"==typeof r&&r.length===a?r:{},o[n]=l(r,i)):o[n]=i);return o}});
(function(t){window.qoopido.register("function/unique/string",t)})(function(){"use strict";function t(t){var e,r="";for(t=parseInt(t,10)||12,e=0;t>e;e++)r+=n[parseInt(Math.random()*(n.length-1),10)];return r}var e={},n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return function(n){var r;do r=t(n);while(e[r]!==undefined);return e[r]=!0,r}});
(function(t){window.qoopido.registerSingleton("url",t)})(function(t,e,o,r,n,i){"use strict";function s(t){var e=i.createElement("a");return e.href=t||"",e}var u,a,c=RegExp("[?&]?([^=]+)=([^&]*)","g");try{u=location}catch(l){u=s()}return a=RegExp("".concat("^",u.protocol,"//",u.hostname),"i"),t.base.extend({resolve:function(t){return s(t).href},redirect:function(t,e){e=e||n,e.location.href=this.resolve(t)},getParameter:function(t){for(var e,o={},r=s(t).search.split("+").join(" ");e=c.exec(r);)o[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return o},isLocal:function(t){return a.test(this.resolve(t))}})});
(function(t){window.qoopido.register("pool",t,["./function/merge","./function/unique/uuid"])})(function(t){"use strict";function e(){var t,e,n,r=this,o=r.metrics,i=r._settings,s=r._queue,l=r._variables,u=1;if(s.length>0&&(l.durationAverage>0&&(u=~~(1>(u=i.frameBudget/l.durationAverage)?1:u)),(t=Math.min(s.length,(e=s.splice(0,u)).length))>0))if(o.inPool+t<=i.maxPoolsize){n=(new Date).getTime();for(var a=0;t>a;a++){var c=e[a],f=c._quid,p=c.dispose;c=r._dispose(c),c._quid=f,c.dispose=p,r._getPool.call(r,c).push(c)}o.inPool+=t,o.inQueue-=t,l.durationSamples+=t,l.durationTotal+=(new Date).getTime()-n,l.durationAverage=l.durationTotal/l.durationSamples}else{if("function"==typeof r._destroy)for(var d=0;t>d;d++)r._destroy(e[d]);e.length=0,o.inQueue-=t,o.destroyed+=t}}var n,r={interval:1e3/60,frameBudget:.5,maxPoolsize:1e3};return n=t.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var o=this;o.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},o._settings=t["function/merge"]({},r,n),o._pool=o._initPool(),o._queue=[],o._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){e.call(o)},o._settings.interval)},_initPool:function(){return[]},_initElement:function(e){var n=this;return e._quid=t["function/unique/uuid"](),e.dispose=function(){n.dispose(e)},n.metrics.total++,e},_getPool:function(){return this._pool},obtain:function(){var t=this,e=t._getPool.apply(t,arguments).pop();return e?(t.metrics.inPool--,t.metrics.recycled++):e=t._initElement(t._obtain.apply(t,arguments)),"function"==typeof e._obtain&&e._obtain.apply(e,arguments),t.metrics.inUse++,e},dispose:function(t){var e=this,n=e._queue;return t._quid||(t=e._initElement(t),e.metrics.inUse++),"function"==typeof t._dispose&&t._dispose(),n.push(t),e.metrics.inUse--,e.metrics.inQueue++,null}})});
(function(t){window.qoopido.register("pool/dom",t,["../pool"])})(function(t,e,n,r,o,i){"use strict";var s=t.pool.extend({_initPool:function(){return{}},_getPool:function(t){var e=this;return"string"!=typeof t&&(t=t.tagName.toLowerCase()),e._pool[t]=e._pool[t]||[]},_dispose:function(t){var e;t.parentNode&&t.parentNode.removeChild(t);for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))try{t.removeAttribute(e)}catch(n){t.property=null}return t},_obtain:function(t){return i.createElement(t)}});return e.pool=e.pool||{},e.pool.dom=s.create(),s});
(function(t){window.qoopido.register("transport",t,["./function/merge"])})(function(t){"use strict";var e;return e=t.base.extend({setup:function(e){var o=this;return o._settings=t["function/merge"]({},o._settings,e),o},serialize:function(t,e){var o,r,n,i=[];for(o in t)r=e?"".concat(e,"[",o,"]"):o,n=t[o],i.push("object"==typeof n?this.serialize(n,r):"".concat(encodeURIComponent(r),"=",encodeURIComponent(n)));return i.join("&")}})},window,document);
(function(t){window.qoopido.registerSingleton("transport/xhr",t,["../transport","../function/merge","../function/unique/string","../url","q"])})(function(t,e,o,r,n,i,s){"use strict";function u(t,e,o){var r,n=this,i=n.xhr,s=n.settings;o="object"==typeof o?n.serialize(o):o,e=s.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=o&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",o):e;for(r in s.xhrOptions)i[r]=s.xhrOptions[r];if(i.open(t,e,s.async,s.username,s.password),i.setRequestHeader){i.setRequestHeader("Accept",s.accept),o&&"GET"!==t&&i.setRequestHeader("Content-Type",s.contentType);for(r in s.header)i.setRequestHeader(r,s.header[r])}i.timeout=s.timeout,i.onprogress=function(t){a.call(n,t)},i.onreadystatechange=i.onload=function(){c.call(n)},i.onerror=function(){l.call(n)},i.send(o||null),n.timeout=setTimeout(function(){p.call(n)},s.timeout)}function a(t){var e=this;e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){p.call(e)},e.settings.timeout),e.dfd.notify(t)}function c(){var t=this,e=t.xhr,o=t.dfd;(e.readyState===s||4===e.readyState)&&(d.call(t),e.status===s||200===e.status?o.resolve({data:e.responseText,xhr:e}):o.reject({status:e.status,xhr:e}))}function l(){var t=this;d.call(t),t.dfd.reject()}function p(){var t=this;t.xhr.abort(),d.call(t),t.dfd.reject()}function d(){var t=this,e=t.xhr;t.timeout&&clearTimeout(t.timeout),e.onprogress=e.onreadystatechange=e.onerror=null}var f,m=t.q||n.Q,h=n.XMLHttpRequest!==s?function(e){return t.url.isLocal(e)?new n.XMLHttpRequest:n.XDomainRequest?new n.XDomainRequest:new n.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return f=t.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(e,o,r,n){var i={};return o=t.url.resolve(o),i.url=o,i.id="".concat("xhr-",t["function/unique/string"]()),i.dfd=m.defer(),i.xhr=h(o),i.settings=t["function/merge"]({},this._settings,n),i.timeout=null,u.call(i,e.toUpperCase(),o,r),i.dfd.promise},get:function(t,e,o){return this.load("GET",t,e,o)},post:function(t,e,o){return this.load("POST",t,e,o)},put:function(t,e,o){return this.load("PUT",t,e,o)},"delete":function(t,e,o){return this.load("DELETE",t,e,o)},head:function(t,e,o){return this.load("HEAD",t,e,o)}})},window,document);
(function(t){window.qoopido.register("polyfill/string/ucfirst",t)})(function(){"use strict";return String.prototype.ucfirst||(String.prototype.ucfirst=function(){var t=this;return t.charAt(0).toUpperCase()+t.slice(1)}),!0});
(function(t){var e=["./base","./pool/dom","q"];String.prototype.ucfirst||e.push("./polyfill/string/ucfirst"),window.qoopido.registerSingleton("support",t,e)})(function(t,e,r,n,o,i,s){"use strict";var l=t.q||o.Q,u=RegExp("-([a-z])","gi"),a=RegExp("^(Moz|WebKit|Khtml|ms|O|Icab)(?=[A-Z])"),c=function(){return arguments[1].ucfirst()},p={prefix:null,method:{},property:{},css:{},element:{},promises:{prefix:null,method:{},property:{},css:{},test:{}}};return t.base.extend({test:{},testMultiple:function(){var t,e=[],r=0;for(r;(t=arguments[r])!==s;r++)switch(typeof t){case"string":e.push(this.test[t]());break;case"boolean":var n=l.defer();t?n.resolve():n.reject(),e.push(n.promise);break;default:e.push(t)}return l.all(e)},getPrefix:function(){var t,r=p.prefix||null;if(null===r){var n=e.pool.dom.obtain("div"),o=n.style;r=!1;for(t in o)a.test(t)&&(r=t.match(a)[0]);r===!1&&"WebkitOpacity"in o&&(r="WebKit"),r===!1&&"KhtmlOpacity"in o&&(r="Khtml"),r=p.prefix=r===!1?!1:{method:r,properties:[r.toLowerCase(),r.toLowerCase().ucfirst()]},n.dispose()}return r},getMethod:function(t,e){e=e||o;var r=e.tagName,n=p.method[r]=p.method[r]||{},i=n[t]=p.method[r][t]||null;if(null===i){i=!1;var l,u,a=0,c=t.ucfirst(),f=this.getPrefix();for(l=f!==!1?(t+" "+f.method+c+" "+f.properties.join(c+" ")+c).split(" "):[t],a;(u=l[a])!==s;a++)if(e[u]!==s&&("function"==typeof e[u]||"object"==typeof e[u])){i=u;break}p.method[r][t]=i}return i},getProperty:function(t,e){e=e||o;var r=e.tagName,n=p.property[r]=p.property[r]||{},i=n[t]=p.property[r][t]||null;if(null===i){i=!1;var l,u,a=0,c=t.ucfirst(),f=this.getPrefix();for(l=f!==!1?(t+" "+f.properties.join(c+" ")+c).split(" "):[t],a;(u=l[a])!==s;a++)if(e[u]!==s){i=u;break}p.property[r][t]=i}return i},getCssProperty:function(t){t=t.replace(u,c);var r=p.css[t]||null;if(null===r){r=!1;var n,o=0,i=e.pool.dom.obtain("div"),l=t.ucfirst(),a=(this.getPrefix()||{properties:[]}).properties,f=(t+" "+a.join(l+" ")+l).split(" ");for(o;(n=f[o])!==s;o++)if(i.style[n]!==s){r=n;break}p.css[t]=r,i.dispose()}return r},supportsPrefix:function(){return!!this.getPrefix()},supportsMethod:function(t,e){return!!this.getMethod(t,e)},supportsProperty:function(t,e){return!!this.getProperty(t,e)},supportsCssProperty:function(t){return!!this.getCssProperty(t)},testPrefix:function(){var t=p.promises.prefix;if(null===t){var e=l.defer(),r=this.getPrefix();r?e.resolve(r):e.reject(),t=p.promises.prefix=e.promise}return t},testMethod:function(t,e){e=e||o;var r=e.tagName,n=p.promises.method[r]=p.promises.method[r]||{},i=n[t]=p.promises.method[r][t]||null;if(null===i){var s=l.defer(),u=this.getMethod(t,e);u?s.resolve(u):s.reject(),i=p.promises.method[r][t]=s.promise}return i},testProperty:function(t,e){e=e||o;var r=e.tagName,n=p.promises.property[r]=p.promises.property[r]||{},i=n[t]=p.promises.property[r][t]||null;if(null===i){var s=l.defer(),u=this.getProperty(t,e);u?s.resolve(u):s.reject(),i=p.promises.property[r][t]=s.promise}return i},testCssProperty:function(t){var e=p.promises.css[t]||null;if(null===e){var r=l.defer(),n=this.getCssProperty(t);n?r.resolve(n):r.reject(),e=p.promises.css[t]=r.promise}return e},addTest:function(t,e){return this.test[t]=function(){var r=p.promises.test[t]||null;if(null===r){var n=l.defer(),o=Array.prototype.slice.call(arguments);o.splice(0,0,n),e.apply(null,o),r=p.promises.test[t]=n.promise}return r}}})});
(function(t){window.qoopido.register("support/capability/datauri",t,["../../support","../../dom/element","../../pool/dom"])})(function(t,e){"use strict";return t.support.addTest("/capability/datauri",function(r){var n=t["dom/element"].create(e.pool.dom.obtain("img"));n.one("error load",function(t){"load"===t.type&&1===n.element.width&&1===n.element.height?r.resolve():r.reject(),n.element.dispose()},!1).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})});
(function(t){window.qoopido.register("support/element/canvas",t,["../../support","../../pool/dom"])})(function(t,e){"use strict";return t.support.addTest("/element/canvas",function(t){var r=e.pool.dom.obtain("canvas");r.getContext&&r.getContext("2d")?t.resolve():t.reject(),r.dispose()})});
(function(t){window.qoopido.register("support/element/canvas/todataurl",t,["../../../support","../canvas","../../../pool/dom"])})(function(t,e,r,o,n,i,s){"use strict";return t.support.addTest("/element/canvas/todataurl",function(r){t["support/element/canvas"]().then(function(){var t=e.pool.dom.obtain("canvas");t.toDataURL!==s?r.resolve():r.reject(),t.dispose()}).fail(function(){r.reject()})})});
(function(t){window.qoopido.register("support/element/canvas/todataurl/png",t,["../../../../support","../todataurl","../../../../pool/dom"])})(function(t,e){"use strict";return t.support.addTest("/element/canvas/todataurl/png",function(r){t["support/element/canvas/todataurl"]().then(function(){var t=e.pool.dom.obtain("canvas");0===t.toDataURL("image/png").indexOf("data:image/png")?r.resolve():r.reject(),t.dispose()}).fail(function(){r.reject()})})});
(function(t){var e=["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr"];window.JSON&&window.JSON.parse||e.push("json"),window.qoopido.register("dom/element/shrinkimage",t,e)})(function(t,e,n,i,r){"use strict";function o(e,n){e=t.url.resolve(v.exec(e)[1]),n=n?!0:!1;var i=this,r=t["function/merge"]({},i._settings,t.url.getParameter(e)),o=r.target||(e=e.split("?")[0]).replace(y,"".concat(".q",r.quality,".shrunk"));n||i.removeAttribute(i._settings.attribute).hide(),t.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(r.debug).then(function(){switch(typeof h[o]){case"object":h[o].one(w,function(t){a.call(i,t.data,n)}),i.emit(_);break;case"string":a.call(i,h[o],n);break;default:h[o]=f.create(o,n?null:i._element).one(E,function(t){t.type===w?(h[o]=t.data,i.emit(b),a.call(i,t.data,n)):(h[o]=e,a.call(i,e,n))},!1)}}).fail(function(){h[o]=e,a.call(i,e,n)}).done()}function a(t,e){var n=this;e?(n.element.style.backgroundImage="url("+t+")",n.emit(w),n.off()):n.one(S,function(){n.show(),n.emit(w),n.off()}).setAttribute("src",t)}function l(t){var e=this;t.get(e._url).done(function(t){try{var n=p.parse(t.data);n.width=parseInt(n.width,10),n.height=parseInt(n.height,10),s.call(e,n)}catch(i){e.emit(x)}},function(){e.emit(x)})}function s(t){var n,i,r=this,o=function(o){return n=e.pool.dom.obtain("canvas"),n.style.display="none",n.width=t.width,n.height=t.height,i=n.getContext("2d"),i.clearRect(0,0,t.width,t.height),i.drawImage(r.element,0,0,t.width,t.height),r.one(S,a).setAttribute("src",t.alpha),u(o)},a=function(e){var o;return i.globalCompositeOperation="xor",i.drawImage(r.element,0,0,t.width,t.height),o=n.toDataURL("image/png"),l(),r.emit(w,o),u(e)},l=function(){n&&n.dispose(),r.element._quid&&r.element.dispose&&r.element.dispose()};r.one(A,function(t){t.type===S?o.call(this,t):(l(),r.emit(x))},!1).setAttribute("src",t.main)}function u(t){return t.preventDefault(),t.stopPropagation(),!1}var c,f,p=t.json||r.JSON,d=n.pop(),g={attribute:"data-"+d,quality:80,debug:!1},h={},m=RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),v=RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),y=RegExp("\\.png$","i"),_="queued",b="cached",w="loaded",x="failed",E="".concat(w," ",x),S="load",q="error",A="".concat(S," ",q);return c=t["dom/element"].extend({_constructor:function(e,n){var i,r,a=this;c._parent._constructor.call(a,e),a._settings=n=t["function/merge"]({},g,n),i=a.getAttribute(n.attribute),r=a.element.style.backgroundImage,"IMG"===a.type&&o.call(a,i),"none"!==r&&m.test(r)&&o.call(a,r,!0)},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),f=t["dom/element"].extend({_url:null,_constructor:function(n,i){var r=this;i||(i=e.pool.dom.obtain("img")),c._parent._constructor.call(r,i),r._url=n,l.call(r,t["transport/xhr"])}}),c},window);