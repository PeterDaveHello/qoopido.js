/*!
* Qoopido.js library package
*
* version: 3.1.2
* date:    2013-10-18
* author:  Dirk Lueth <info@qoopido.com>
* website: https://github.com/dlueth/qoopido.js
*
* Copyright (c) 2013 Dirk Lueth
*
* Dual licensed under the MIT and GPL licenses.
*  - http://www.opensource.org/licenses/mit-license.php
*  - http://www.gnu.org/copyleft/gpl.html
*/
(function(t){window.qoopido.register("polyfill/object/defineproperty",t)})(function(){"use strict";if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()){var t=Object.defineProperty,e=Object.prototype.__defineGetter__,n=Object.prototype.__defineSetter__;Object.defineProperty=function(r,i,o){if(t)try{return t(r,i,o)}catch(s){}if(r!==Object(r))throw new TypeError("Object.defineProperty called on non-object");return e&&"get"in o&&e.call(r,i,o.get),n&&"set"in o&&n.call(r,i,o.set),"value"in o&&(r[i]=o.value),r}}return!0});
(function(t){var e=[];Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()||e.push("./defineproperty"),window.qoopido.register("polyfill/object/defineproperties",t,e)})(function(){"use strict";return Object.defineProperties||(Object.defineProperties=function(t,e){if(t!==Object(t))throw new TypeError("Object.defineProperties called on non-object");var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(t,n,e[n]);return t}),!0});
(function(t){var e=[];Object.defineProperties||e.push("./defineproperties"),window.qoopido.register("polyfill/object/create",t,e)})(function(){"use strict";return Object.create||(Object.create=function(t,e){function n(){}if("object"!=typeof t)throw new TypeError;n.prototype=t;var r=new n;if(t&&(r.constructor=n),arguments.length>1){if(e!==Object(e))throw new TypeError;Object.defineProperties(r,e)}return r}),!0});
(function(t){window.qoopido.register("polyfill/object/getownpropertydescriptor",t)})(function(){"use strict";if(!Object.getOwnPropertyDescriptor||!function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(t){return!1}}()){var t=Object.getOwnPropertyDescriptor;Object.getOwnPropertyDescriptor=function(e,n){if(e!==Object(e))throw new TypeError;try{return t.call(Object,e,n)}catch(r){}return Object.prototype.hasOwnProperty.call(e,n)?{value:e[n],enumerable:!0,writable:!0,configurable:!0}:undefined}}return!0});
(function(e,t,r,n,o){"use strict";function c(e,c,i,u){var p,f=e.split("/");return a[e]?a[e]:(p=function(){if(i){var p,l,g=f.slice(0,-1).join("/");for(p=0;(l=i[p])!==o;p++)d.test(l)&&(l=s(g+"/"+l)),!a[l]&&arguments[p]&&(a[l]=arguments[p]),a[l]||"undefined"==typeof console||console.error("".concat("[Qoopido.js] ",e,": Could not load dependency ",l))}return a[e]=c(a,f,t,r,n,o),u&&u(a[e]),a[e]},"function"==typeof define&&define.amd?i?define(i,p):define(p):p(),o)}function i(e,t,r){c(e,t,r,function(t){a[e]=t.create()})}function s(e){for(var t;(t=e.replace(l,""))!==e;)e=t;return e.replace(g,"")}var u="qoopido",p=r[u]=r[u]||{register:c,registerSingleton:i},a=(p.shared=p.shared||{},p.modules=p.modules||{}),f=[],d=RegExp("^\\.+\\/"),l=RegExp("(?:\\/|)[^\\/]*\\/\\.\\."),g=RegExp("(^\\/)|\\.\\/","g");Object.create||f.push("./polyfill/object/create"),Object.getOwnPropertyNames||f.push("./polyfill/object/getownpropertynames"),Object.getOwnPropertyDescriptor&&function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(e){return!1}}()||f.push("./polyfill/object/getownpropertydescriptor"),c("base",e,f)})(function(e,t,r,n,o,c){"use strict";function i(e){var t,r,n={},o=Object.getOwnPropertyNames(e);for(t=0;(r=o[t])!==c;t++)n[r]=Object.getOwnPropertyDescriptor(e,r);return n}return{create:function(){var e,t=Object.create(this,i(this));return t._constructor&&(e=t._constructor.apply(t,arguments)),t.create=t.extend=c,e||t},extend:function(e){return e=e||{},e._parent=this,Object.create(this,i(e))}}},navigator,window,document);
(function(t){window.qoopido.register("proxy",t,["./function/unique/uuid"])})(function(t){"use strict";return t.base.extend({_constructor:function(e,n){var r=Array.prototype.splice.call(arguments,2),o=function(){return n.apply(e,Array.prototype.slice.call(arguments,0).concat(r))};return o._quid=t["function/unique/uuid"](),o}})});
(function(t){var e=["../proxy"];window.getComputedStyle||e.push("../polyfill/window/getcomputedstyle"),window.qoopido.register("dom/element",t,e)})(function(t,e,n,r,i,o){"use strict";function a(t){return t.target||(t.target=t.srcElement||i),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t}var s,l,u,c="object",f="string";return s=r.addEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r[i]=function(t){e.call(this,a(t))},r.addEventListener(t,r[i],!1)}:function(t,e){var n=this,i=n.element,s="".concat("listener[",t,"][",e._quid||e,"]");i[s]=function(){e.call(this,a(r.event))},i["on"+t]!==o?i.attachEvent("on"+t,i[s]):(t="".concat("fake[",t,"]"),i[t]=null,i.attachEvent("onpropertychange",function(n){n.propertyName===t&&e.call(this,a(i[t]))}))},l=r.removeEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.removeEventListener(t,r[i],!1),delete r[i]}:function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.detachEvent("on"+t,r[i]),delete r[i]},u=i.createEvent?function(t,e){var n=this,r=n.element,o=i.createEvent("HTMLEvents");o.initEvent(t,!0,!0),o.data=e,r.dispatchEvent(o)}:function(t,e){var n=this,r=n.element,a=i.createEventObject();a.type=a.eventType=t,a.data=e;try{r.fireEvent("on"+a.eventType,a)}catch(s){var l="".concat("fake[",t,"]");r[l]!==o&&(r[l]=a)}},t.base.extend({type:null,element:null,listener:null,_constructor:function(t){var e=this;if(!t)throw Error("Missing element argument");e.type=t.tagName,e.element=t,e.listener={}},getAttribute:function(t){if(t&&typeof t===f){var e=this;return t=t.split(" "),1===t.length?e.element.getAttribute(t[0]):e.getAttributes(t)}},getAttributes:function(t){var e=this,n={};if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var r,i;for(r=0;(i=t[r])!==o;r++)n[i]=e.element.getAttributes(i)}return n},setAttribute:function(t,e){var n=this;return t&&typeof t===f&&n.element.setAttribute(t,e),n},setAttributes:function(t){var e=this;if(t&&typeof t===c&&!t.length){var n;for(n in t)e.element.setAttribute(n,t[n])}return e},removeAttribute:function(t){var e=this;return t&&typeof t===f&&(t=t.split(" "),1===t.length?e.element.removeAttribute(t[0]):e.removeAttributes(t)),e},removeAttributes:function(t){var e=this;if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var n,r;for(n=0;(r=t[n])!==o;n++)e.element.removeAttribute(r)}return e},getStyle:function(t){if(t&&typeof t===f){var e=this;return t=t.split(" "),1===t.length?r.getComputedStyle(e.element,null).getPropertyValue(t[0]):e.getStyles(t)}},getStyles:function(t){var e=this,n={};if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var i,a;for(i=0;(a=t[i])!==o;i++)n[a]=r.getComputedStyle(e.element,null).getPropertyValue(a)}return n},setStyle:function(t,e){var n=this;return t&&typeof t===f&&(n.element.style[t]=e),n},setStyles:function(t){var e=this;if(t&&typeof t===c&&!t.length){var n;for(n in t)e.element.style[n]=t[n]}return e},isVisible:function(){var t=this.element;return!(0>=t.offsetWidth&&0>=t.offsetHeight)},on:function(t,e){var n,r,i=this;for(t=t.split(" "),n=0;(r=t[n])!==o;n++)(i.listener[r]=i.listener[r]||[]).push(e),s.call(i,r,e);return i},one:function(e,n,r){r=r!==!1;var i=this,o=t.proxy.create(i,function(t){i.off(r===!0?t.type:e,o),n.call(i,t)});return i.on(e,o),i},off:function(t,e){var n,r,i,a,s=this;if(t)for(t=t.split(" "),n=0;(r=t[n])!==o;n++)if(s.listener[r]=s.listener[r]||[],e)for(i=0;(a=s.listener[r][i])!==o;i++)a===e&&(s.listener[r].splice(i,1),l.call(s,r,a),i--);else for(;s.listener[r].length>0;)l.call(s,r,s.listener[r].pop());else for(r in s.listener)for(;s.listener[r].length>0;)l.call(s,r,s.listener[r].pop());return s},emit:function(t,e){var n=this;return u.call(n,t,e),n}})});
(function(t){window.qoopido.register("function/merge",t)})(function(t,e,n,r,i,o){"use strict";return function a(){var t,e,n,r,i,l=arguments[0];for(t=1;(e=arguments[t])!==o;t++)for(n in e)r=l[n],i=e[n],i!==o&&(null!==i&&"object"==typeof i?(r=i.length!==o?r&&"object"==typeof r&&r.length!==o?r:[]:r&&"object"==typeof r&&r.length===o?r:{},l[n]=a(r,i)):l[n]=i);return l}});
(function(t){window.qoopido.register("function/unique/uuid",t)})(function(){"use strict";function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,function(t){var e=0|16*Math.random(),n="x"===t?e:8|3&e;return n.toString(16)})}var e={},n=RegExp("[xy]","g");return function(){var n;do n=t();while(e[n]!==undefined);return e[n]=!0,n}});
(function(t){window.qoopido.register("function/unique/string",t)})(function(){"use strict";function t(t){var e,r="";for(t=parseInt(t,10)||12,e=0;t>e;e++)r+=n[parseInt(Math.random()*(n.length-1),10)];return r}var e={},n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return function(n){var r;do r=t(n);while(e[r]!==undefined);return e[r]=!0,r}});
(function(t){window.qoopido.registerSingleton("url",t)})(function(t,e,o,r,n){"use strict";function i(t){var e=n.createElement("a");return e.href=t||"",e}var s,u,a=RegExp("[?&]?([^=]+)=([^&]*)","g");try{s=location}catch(c){s=i()}return u=RegExp("".concat("^",s.protocol,"//",s.hostname),"i"),t.base.extend({resolve:function(t){return i(t).href},redirect:function(t,e){e=e||r,e.location.href=this.resolve(t)},getParameter:function(t){for(var e,o={},r=i(t).search.split("+").join(" ");e=a.exec(r);)o[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return o},isLocal:function(t){return u.test(this.resolve(t))}})});
(function(t){window.qoopido.register("pool",t,["./function/merge","./function/unique/uuid"])})(function(t){"use strict";function e(){var t,e,n,r=this,i=r.metrics,o=r._settings,s=r._queue,l=r._variables,u=1;if(s.length>0&&(l.durationAverage>0&&(u=~~(1>(u=o.frameBudget/l.durationAverage)?1:u)),(t=Math.min(s.length,(e=s.splice(0,u)).length))>0))if(i.inPool+t<=o.maxPoolsize){n=(new Date).getTime();for(var a=0;t>a;a++){var c=e[a],f=c._quid,p=c.dispose;c=r._dispose(c),c._quid=f,c.dispose=p,r._getPool.call(r,c).push(c)}i.inPool+=t,i.inQueue-=t,l.durationSamples+=t,l.durationTotal+=(new Date).getTime()-n,l.durationAverage=l.durationTotal/l.durationSamples}else{if("function"==typeof r._destroy)for(var d=0;t>d;d++)r._destroy(e[d]);e.length=0,i.inQueue-=t,i.destroyed+=t}}var n,r={interval:1e3/60,frameBudget:.5,maxPoolsize:1e3};return n=t.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var i=this;i.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},i._settings=t["function/merge"]({},r,n),i._pool=i._initPool(),i._queue=[],i._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){e.call(i)},i._settings.interval)},_initPool:function(){return[]},_initElement:function(e){var n=this;return e._quid=t["function/unique/uuid"](),e.dispose=function(){n.dispose(e)},n.metrics.total++,e},_getPool:function(){return this._pool},obtain:function(){var t=this,e=t._getPool.apply(t,arguments).pop();return e?(t.metrics.inPool--,t.metrics.recycled++):e=t._initElement(t._obtain.apply(t,arguments)),"function"==typeof e._obtain&&e._obtain.apply(e,arguments),t.metrics.inUse++,e},dispose:function(t){var e=this,n=e._queue;return t._quid||(t=e._initElement(t),e.metrics.inUse++),"function"==typeof t._dispose&&t._dispose(),n.push(t),e.metrics.inUse--,e.metrics.inQueue++,null}})});
(function(t){window.qoopido.register("pool/dom",t,["../pool"])})(function(t,e,n,r,o){"use strict";var i=t.pool.extend({_initPool:function(){return{}},_getPool:function(t){var e=this;return"string"!=typeof t&&(t=t.tagName.toLowerCase()),e._pool[t]=e._pool[t]||[]},_dispose:function(t){var e;t.parentNode&&t.parentNode.removeChild(t);for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))try{t.removeAttribute(e)}catch(n){t.property=null}return t},_obtain:function(t){return o.createElement(t)}});return r.qoopido.shared.pool=r.qoopido.shared.pool||{},r.qoopido.shared.pool.dom=i.create(),i});
(function(t){window.qoopido.register("transport",t,["./function/merge"])})(function(t){"use strict";var e;return e=t.base.extend({setup:function(e){var o=this;return o._settings=t["function/merge"]({},o._settings,e),o},serialize:function(t,e){var o,r,n,i=[];for(o in t)r=e?"".concat(e,"[",o,"]"):o,n=t[o],i.push("object"==typeof n?this.serialize(n,r):"".concat(encodeURIComponent(r),"=",encodeURIComponent(n)));return i.join("&")}})},window,document);
(function(t){window.qoopido.registerSingleton("transport/xhr",t,["../transport","../function/merge","../function/unique/string","../url","q"])})(function(t,e,o,r,n,i){"use strict";function s(t,e,o){var r,n=this,i=n.xhr,s=n.settings;o="object"==typeof o?n.serialize(o):o,e=s.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=o&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",o):e;for(r in s.xhrOptions)i[r]=s.xhrOptions[r];if(i.open(t,e,s.async,s.username,s.password),i.setRequestHeader){i.setRequestHeader("Accept",s.accept),o&&"GET"!==t&&i.setRequestHeader("Content-Type",s.contentType);for(r in s.header)i.setRequestHeader(r,s.header[r])}i.timeout=s.timeout,i.onprogress=function(t){u.call(n,t)},i.onreadystatechange=i.onload=function(){a.call(n)},i.onerror=function(){c.call(n)},i.send(o||null),n.timeout=setTimeout(function(){l.call(n)},s.timeout)}function u(t){var e=this;e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){l.call(e)},e.settings.timeout),e.dfd.notify(t)}function a(){var t=this,e=t.xhr,o=t.dfd;(e.readyState===i||4===e.readyState)&&(p.call(t),e.status===i||200===e.status?o.resolve({data:e.responseText,xhr:e}):o.reject({status:e.status,xhr:e}))}function c(){var t=this;p.call(t),t.dfd.reject()}function l(){var t=this;t.xhr.abort(),p.call(t),t.dfd.reject()}function p(){var t=this,e=t.xhr;t.timeout&&clearTimeout(t.timeout),e.onprogress=e.onreadystatechange=e.onerror=null}var d,f=t.q||r.Q,m=r.XMLHttpRequest!==i?function(e){return t.url.isLocal(e)?new r.XMLHttpRequest:r.XDomainRequest?new r.XDomainRequest:new r.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return d=t.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(e,o,r,n){var i={};return o=t.url.resolve(o),i.url=o,i.id="".concat("xhr-",t["function/unique/string"]()),i.dfd=f.defer(),i.xhr=m(o),i.settings=t["function/merge"]({},this._settings,n),i.timeout=null,s.call(i,e.toUpperCase(),o,r),i.dfd.promise},get:function(t,e,o){return this.load("GET",t,e,o)},post:function(t,e,o){return this.load("POST",t,e,o)},put:function(t,e,o){return this.load("PUT",t,e,o)},"delete":function(t,e,o){return this.load("DELETE",t,e,o)},head:function(t,e,o){return this.load("HEAD",t,e,o)}})},window,document);
(function(t){window.qoopido.register("polyfill/string/ucfirst",t)})(function(){"use strict";return String.prototype.ucfirst||(String.prototype.ucfirst=function(){var t=this;return t.charAt(0).toUpperCase()+t.slice(1)}),!0});
(function(t){window.qoopido.registerSingleton("support",t,["./base","./polyfill/string/ucfirst","./pool/dom","q"])})(function(t,e,r,n,o,i){"use strict";var s=t.q||n.Q,l=RegExp("-([a-z])","gi"),u=RegExp("^(Moz|WebKit|Khtml|ms|O|Icab)(?=[A-Z])"),a=function(t){return t.ucfirst()},c={prefix:null,method:{},property:{},css:{},element:{},promises:{prefix:null,method:{},property:{},css:{},test:{}}};return t.base.extend({test:{},testMultiple:function(){var t,e=[],r=0;for(r;(t=arguments[r])!==i;r++)switch(typeof t){case"string":e.push(this.test[t]());break;case"boolean":var n=s.defer();t?n.resolve():n.reject(),e.push(n.promise);break;default:e.push(t)}return s.all(e)},getPrefix:function(){var t,e=c.prefix||null;if(null===e){var r=n.qoopido.shared.pool.dom.obtain("div"),o=r.style;e=!1;for(t in o)u.test(t)&&(e=t.match(u)[0]);e===!1&&"WebkitOpacity"in o&&(e="WebKit"),e===!1&&"KhtmlOpacity"in o&&(e="Khtml"),e=c.prefix=e===!1?!1:{method:e,properties:[e.toLowerCase(),e.toLowerCase().ucfirst()]},r.dispose()}return e},getMethod:function(t,e){e=e||n;var r=e.tagName,o=c.method[r]=c.method[r]||{},s=o[t]=c.method[r][t]||null;if(null===s){s=!1;var l,u,a=0,p=t.ucfirst(),f=this.getPrefix();for(l=f!==!1?(t+" "+f.method+p+" "+f.properties.join(p+" ")+p).split(" "):[t],a;(u=l[a])!==i;a++)if(e[u]!==i&&("function"==typeof e[u]||"object"==typeof e[u])){s=u;break}c.method[r][t]=s}return s},getProperty:function(t,e){e=e||n;var r=e.tagName,o=c.property[r]=c.property[r]||{},s=o[t]=c.property[r][t]||null;if(null===s){s=!1;var l,u,a=0,p=t.ucfirst(),f=this.getPrefix();for(l=f!==!1?(t+" "+f.properties.join(p+" ")+p).split(" "):[t],a;(u=l[a])!==i;a++)if(e[u]!==i){s=u;break}c.property[r][t]=s}return s},getCssProperty:function(t){t=t.replace(l,a);var e=c.css[t]||null;if(null===e){e=!1;var r,o=0,s=n.qoopido.shared.pool.dom.obtain("div"),u=t.ucfirst(),p=(this.getPrefix()||{properties:[]}).properties,f=(t+" "+p.join(u+" ")+u).split(" ");for(o;(r=f[o])!==i;o++)if(s.style[r]!==i){e=r;break}c.css[t]=e,s.dispose()}return e},supportsPrefix:function(){return!!this.getPrefix()},supportsMethod:function(t,e){return!!this.getMethod(t,e)},supportsProperty:function(t,e){return!!this.getProperty(t,e)},supportsCssProperty:function(t){return!!this.getCssProperty(t)},testPrefix:function(){var t=c.promises.prefix;if(null===t){var e=s.defer(),r=this.getPrefix();r?e.resolve(r):e.reject(),t=c.promises.prefix=e.promise}return t},testMethod:function(t,e){e=e||n;var r=e.tagName,o=c.promises.method[r]=c.promises.method[r]||{},i=o[t]=c.promises.method[r][t]||null;if(null===i){var l=s.defer(),u=this.getMethod(t,e);u?l.resolve(u):l.reject(),i=c.promises.method[r][t]=l.promise}return i},testProperty:function(t,e){e=e||n;var r=e.tagName,o=c.promises.property[r]=c.promises.property[r]||{},i=o[t]=c.promises.property[r][t]||null;if(null===i){var l=s.defer(),u=this.getProperty(t,e);u?l.resolve(u):l.reject(),i=c.promises.property[r][t]=l.promise}return i},testCssProperty:function(t){var e=c.promises.css[t]||null;if(null===e){var r=s.defer(),n=this.getCssProperty(t);n?r.resolve(n):r.reject(),e=c.promises.css[t]=r.promise}return e},addTest:function(t,e){return this.test[t]=function(){var r=c.promises.test[t]||null;if(null===r){var n=s.defer(),o=Array.prototype.slice.call(arguments);o.splice(0,0,n),e.apply(null,o),r=c.promises.test[t]=n.promise}return r}}})});
(function(t){window.qoopido.register("support/capability/datauri",t,["../../support","../../dom/element","../../pool/dom"])})(function(t,e,r,n){"use strict";return t.support.addTest("/capability/datauri",function(e){var r=t["dom/element"].create(n.qoopido.shared.pool.dom.obtain("img"));r.one("error load",function(t){"load"===t.type&&1===r.element.width&&1===r.element.height?e.resolve():e.reject(),r.element.dispose()},!1).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})});
(function(t){window.qoopido.register("support/element/canvas",t,["../../support","../../pool/dom"])})(function(t,e,r,o){"use strict";return t.support.addTest("/element/canvas",function(t){var e=o.qoopido.shared.pool.dom.obtain("canvas");e.getContext&&e.getContext("2d")?t.resolve():t.reject(),e.dispose()})});
(function(t){window.qoopido.register("support/element/canvas/todataurl",t,["../../../support","../canvas","../../../pool/dom"])})(function(t,e,r,o,n,i){"use strict";return t.support.addTest("/element/canvas/todataurl",function(e){t["support/element/canvas"]().then(function(){var t=o.qoopido.shared.pool.dom.obtain("canvas");t.toDataURL!==i?e.resolve():e.reject(),t.dispose()}).fail(function(){e.reject()})})});
(function(t){window.qoopido.register("support/element/canvas/todataurl/png",t,["../../../../support","../todataurl","../../../../pool/dom"])})(function(t,e,r,o){"use strict";return t.support.addTest("/element/canvas/todataurl/png",function(e){t["support/element/canvas/todataurl"]().then(function(){var t=o.qoopido.shared.pool.dom.obtain("canvas");0===t.toDataURL("image/png").indexOf("data:image/png")?e.resolve():e.reject(),t.dispose()}).fail(function(){e.reject()})})});
(function(t){window.qoopido.register("dom/element/shrinkimage",t,["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr","../../pool/dom","json"])})(function(t,e,n,i){"use strict";function r(e,n){e=t.url.resolve(h.exec(e)[1]),n=n?!0:!1;var i=this,r=t["function/merge"]({},i._settings,t.url.getParameter(e)),a=r.target||(e=e.split("?")[0]).replace(m,"".concat(".q",r.quality,".shrunk"));n||i.removeAttribute(i._settings.attribute).hide(),t.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(r.debug).then(function(){switch(typeof p[a]){case"object":p[a].one(_,function(t){o.call(i,t.data,n)}),i.emit(v);break;case"string":o.call(i,p[a],n);break;default:p[a]=c.create(a,n?null:i._element).one(w,function(t){t.type===_?(p[a]=t.data,i.emit(y),o.call(i,t.data,n)):(p[a]=e,o.call(i,e,n))},!1)}}).fail(function(){p[a]=e,o.call(i,e,n)}).done()}function o(t,e){var n=this;e?(n.element.style.backgroundImage="url("+t+")",n.emit(_),n.off()):n.one(x,function(){n.show(),n.emit(_),n.off()}).setAttribute("src",t)}function a(t){var e=this;t.get(e._url).done(function(t){try{var n=JSON.parse(t.data);n.width=parseInt(n.width,10),n.height=parseInt(n.height,10),l.call(e,n)}catch(i){e.emit(b)}},function(){e.emit(b)})}function l(t){var e,n,r=this,o=function(o){return e=i.qoopido.shared.pool.dom.obtain("canvas"),e.style.display="none",e.width=t.width,e.height=t.height,n=e.getContext("2d"),n.clearRect(0,0,t.width,t.height),n.drawImage(r.element,0,0,t.width,t.height),r.one(x,a).setAttribute("src",t.alpha),s(o)},a=function(i){var o;return n.globalCompositeOperation="xor",n.drawImage(r.element,0,0,t.width,t.height),o=e.toDataURL("image/png"),l(),r.emit(_,o),s(i)},l=function(){e&&e.dispose(),r.element._quid&&r.element.dispose&&r.element.dispose()};r.one(q,function(t){t.type===x?o.call(this,t):(l(),r.emit(b))},!1).setAttribute("src",t.main)}function s(t){return t.preventDefault(),t.stopPropagation(),!1}var u,c,f=e.pop(),d={attribute:"data-"+f,quality:80,debug:!1},p={},g=RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),h=RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),m=RegExp("\\.png$","i"),v="queued",y="cached",_="loaded",b="failed",w="".concat(_," ",b),x="load",E="error",q="".concat(x," ",E);return u=t["dom/element"].extend({_constructor:function(e,n){var i,o,a=this;u._parent._constructor.call(a,e),a._settings=n=t["function/merge"]({},d,n),i=a.getAttribute(n.attribute),o=a.element.style.backgroundImage,"IMG"===a.type&&r.call(a,i),"none"!==o&&g.test(o)&&r.call(a,o,!0)},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),c=t["dom/element"].extend({_url:null,_constructor:function(e,n){var r=this;n||(n=i.qoopido.shared.pool.dom.obtain("img")),u._parent._constructor.call(r,n),r._url=e,a.call(r,t["transport/xhr"])}}),u});