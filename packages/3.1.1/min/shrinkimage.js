/*!
* Qoopido.js library package
*
* version: 3.1.1
* date:    2013-10-17
* author:  Dirk Lueth <info@qoopido.com>
* website: https://github.com/dlueth/qoopido.js
*
* Copyright (c) 2013 Dirk Lueth
*
* Dual licensed under the MIT and GPL licenses.
*  - http://www.opensource.org/licenses/mit-license.php
*  - http://www.gnu.org/copyleft/gpl.html
*/
(function(t){"use strict";"function"==typeof define&&define.amd?define(t):t()})(function(){"use strict";if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()){var t=Object.defineProperty,e=Object.prototype.__defineGetter__,n=Object.prototype.__defineSetter__;Object.defineProperty=function(i,r,o){if(t)try{return t(i,r,o)}catch(a){}if(i!==Object(i))throw new TypeError("Object.defineProperty called on non-object");return e&&"get"in o&&e.call(i,r,o.get),n&&"set"in o&&n.call(i,r,o.set),"value"in o&&(i[r]=o.value),i}}});
(function(t){"use strict";if("function"==typeof define&&define.amd){var e=[];Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}()||e.push("./defineproperty"),define(e,t)}else t()})(function(){"use strict";Object.defineProperties||(Object.defineProperties=function(t,e){if(t!==Object(t))throw new TypeError("Object.defineProperties called on non-object");var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&Object.defineProperty(t,n,e[n]);return t})});
(function(t){"use strict";if("function"==typeof define&&define.amd){var e=[];Object.defineProperties||e.push("./defineproperties"),define(e,t)}else t()})(function(){"use strict";Object.create||(Object.create=function(t,e){function n(){}if("object"!=typeof t)throw new TypeError;n.prototype=t;var i=new n;if(t&&(i.constructor=n),arguments.length>1){if(e!==Object(e))throw new TypeError;Object.defineProperties(i,e)}return i})});
(function(t){"use strict";"function"==typeof define&&define.amd?define(t):t()})(function(){"use strict";if(!Object.getOwnPropertyDescriptor||!function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(t){return!1}}()){var t=Object.getOwnPropertyDescriptor;Object.getOwnPropertyDescriptor=function(e,n){if(e!==Object(e))throw new TypeError;try{return t.call(Object,e,n)}catch(i){}return Object.prototype.hasOwnProperty.call(e,n)?{value:e[n],enumerable:!0,writable:!0,configurable:!0}:void 0}}});
(function(e,t,r,n){"use strict";function c(e,c,o,i){var u=e.split("/");return s[e]?s[e]:(o=o?[].slice.call(o,0):[],s[e]=function(){return i===!0?c.call(null,s,o,u,t,r,n).create():c.call(null,s,o,u,t,r,n)}())}function o(){return c("base",e)}var i="qoopido",u=t[i]=t[i]||{initialize:c},s=(u.shared=u.shared||{},u.modules=u.modules||{});if("function"==typeof define&&define.amd){var a=[];Object.create||a.push("./polyfill/object/create"),Object.getOwnPropertyNames||a.push("./polyfill/object/getownpropertynames"),Object.getOwnPropertyDescriptor&&function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(e){return!1}}()||a.push("./polyfill/object/getownpropertydescriptor"),define(a,o)}else o()})(function(e,t,r,n,c,o){"use strict";function i(e){var t,r,n={},c=Object.getOwnPropertyNames(e);for(t=0;(r=c[t])!==o;t++)n[r]=Object.getOwnPropertyDescriptor(e,r);return n}return{create:function(){var e,t=Object.create(this,i(this));return t._constructor&&(e=t._constructor.apply(t,arguments)),t.create=t.extend=o,e||t},extend:function(e){return e=e||{},e._parent=this,Object.create(this,i(e))}}},window,document);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("proxy",t)}"function"==typeof define&&define.amd?define(["./base","./function/unique/uuid"],n):n()})(function(t){"use strict";return t.base.extend({_constructor:function(e,n){var i=Array.prototype.splice.call(arguments,2),r=function(){return n.apply(e,Array.prototype.slice.call(arguments,0).concat(i))};return r._quid=t["function/unique/uuid"](),r}})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("dom/element",t,arguments)}if("function"==typeof define&&define.amd){var r=["../base","../proxy"];e.getComputedStyle||r.push("../polyfill/window/getcomputedstyle"),define(r,n)}else n()})(function(t,e,n,r,i,o){"use strict";function a(t){return t.target||(t.target=t.srcElement||i),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t}var s,l,u,c="object",f="string";return s=r.addEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r[i]=function(t){e.call(this,a(t))},r.addEventListener(t,r[i],!1)}:function(t,e){var n=this,i=n.element,s="".concat("listener[",t,"][",e._quid||e,"]");i[s]=function(){e.call(this,a(r.event))},i["on"+t]!==o?i.attachEvent("on"+t,i[s]):(t="".concat("fake[",t,"]"),i[t]=null,i.attachEvent("onpropertychange",function(n){n.propertyName===t&&e.call(this,a(i[t]))}))},l=r.removeEventListener?function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.removeEventListener(t,r[i],!1),delete r[i]}:function(t,e){var n=this,r=n.element,i="".concat("listener[",t,"][",e._quid||e,"]");r.detachEvent("on"+t,r[i]),delete r[i]},u=i.createEvent?function(t,e){var n=this,r=n.element,o=i.createEvent("HTMLEvents");o.initEvent(t,!0,!0),o.data=e,r.dispatchEvent(o)}:function(t,e){var n=this,r=n.element,a=i.createEventObject();a.type=a.eventType=t,a.data=e;try{r.fireEvent("on"+a.eventType,a)}catch(s){var l="".concat("fake[",t,"]");r[l]!==o&&(r[l]=a)}},t.base.extend({type:null,element:null,listener:null,_constructor:function(t){var e=this;if(!t)throw Error("Missing element argument");e.type=t.tagName,e.element=t,e.listener={}},getAttribute:function(t){if(t&&typeof t===f){var e=this;return t=t.split(" "),1===t.length?e.element.getAttribute(t[0]):e.getAttributes(t)}},getAttributes:function(t){var e=this,n={};if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var r,i;for(r=0;(i=t[r])!==o;r++)n[i]=e.element.getAttributes(i)}return n},setAttribute:function(t,e){var n=this;return t&&typeof t===f&&n.element.setAttribute(t,e),n},setAttributes:function(t){var e=this;if(t&&typeof t===c&&!t.length){var n;for(n in t)e.element.setAttribute(n,t[n])}return e},removeAttribute:function(t){var e=this;return t&&typeof t===f&&(t=t.split(" "),1===t.length?e.element.removeAttribute(t[0]):e.removeAttributes(t)),e},removeAttributes:function(t){var e=this;if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var n,r;for(n=0;(r=t[n])!==o;n++)e.element.removeAttribute(r)}return e},getStyle:function(t){if(t&&typeof t===f){var e=this;return t=t.split(" "),1===t.length?r.getComputedStyle(e.element,null).getPropertyValue(t[0]):e.getStyles(t)}},getStyles:function(t){var e=this,n={};if(t&&(t=typeof t===f?t.split(" "):t,typeof t===c&&t.length)){var i,a;for(i=0;(a=t[i])!==o;i++)n[a]=r.getComputedStyle(e.element,null).getPropertyValue(a)}return n},setStyle:function(t,e){var n=this;return t&&typeof t===f&&(n.element.style[t]=e),n},setStyles:function(t){var e=this;if(t&&typeof t===c&&!t.length){var n;for(n in t)e.element.style[n]=t[n]}return e},isVisible:function(){var t=this.element;return!(0>=t.offsetWidth&&0>=t.offsetHeight)},on:function(t,e){var n,r,i=this;for(t=t.split(" "),n=0;(r=t[n])!==o;n++)(i.listener[r]=i.listener[r]||[]).push(e),s.call(i,r,e);return i},one:function(e,n,r){r=r!==!1;var i=this,o=t.proxy.create(i,function(t){i.off(r===!0?t.type:e,o),n.call(i,t)});return i.on(e,o),i},off:function(t,e){var n,r,i,a,s=this;if(t)for(t=t.split(" "),n=0;(r=t[n])!==o;n++)if(s.listener[r]=s.listener[r]||[],e)for(i=0;(a=s.listener[r][i])!==o;i++)a===e&&(s.listener[r].splice(i,1),l.call(s,r,a),i--);else for(;s.listener[r].length>0;)l.call(s,r,s.listener[r].pop());else for(r in s.listener)for(;s.listener[r].length>0;)l.call(s,r,s.listener[r].pop());return s},emit:function(t,e){var n=this;return u.call(n,t,e),n}})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("function/merge",t,arguments)}"function"==typeof define&&define.amd?define(["../base"],n):n()})(function(t,e,n,i,r,o){"use strict";return function a(){var t,e,n,i,r,l=arguments[0];for(t=1;(e=arguments[t])!==o;t++)for(n in e)i=l[n],r=e[n],r!==o&&(null!==r&&"object"==typeof r?(i=r.length!==o?i&&"object"==typeof i&&i.length!==o?i:[]:i&&"object"==typeof i&&i.length===o?i:{},l[n]=a(i,r)):l[n]=r);return l}},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("function/unique/uuid",t)}"function"==typeof define&&define.amd?define(["./../../base"],n):n()})(function(){"use strict";function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(n,function(t){var e=0|16*Math.random(),n="x"===t?e:8|3&e;return n.toString(16)})}var e={},n=RegExp("[xy]","g");return function(){var n;do n=t();while(e[n]!==void 0);return e[n]=!0,n}},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("function/unique/string",t)}"function"==typeof define&&define.amd?define(["../../base"],n):n()})(function(){"use strict";function t(t){var e,i="";for(t=parseInt(t,10)||12,e=0;t>e;e++)i+=n[parseInt(Math.random()*(n.length-1),10)];return i}var e={},n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return function(n){var i;do i=t(n);while(e[i]!==void 0);return e[i]=!0,i}},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("url",t,arguments,!0)}"function"==typeof define&&define.amd?define(["./base"],n):n()})(function(t,e,n,o,i){"use strict";function r(t){var e=i.createElement("a");return e.href=t||"",e}var s,u,a=RegExp("[?&]?([^=]+)=([^&]*)","g");try{s=location}catch(c){s=r()}return u=RegExp("".concat("^",s.protocol,"//",s.hostname),"i"),t.base.extend({resolve:function(t){return r(t).href},redirect:function(t,e){e=e||o,e.location.href=this.resolve(t)},getParameter:function(t){for(var e,n={},o=r(t).search.split("+").join(" ");e=a.exec(o);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n},isLocal:function(t){return u.test(this.resolve(t))}})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("pool",t,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/merge","./function/unique/uuid"],n):n()})(function(t){"use strict";function e(){var t,e,n,i=this,r=i.metrics,o=i._settings,u=i._queue,s=i._variables,a=1;if(u.length>0&&(s.durationAverage>0&&(a=~~(1>(a=o.frameBudget/s.durationAverage)?1:a)),(t=Math.min(u.length,(e=u.splice(0,a)).length))>0))if(r.inPool+t<=o.maxPoolsize){n=(new Date).getTime();for(var c=0;t>c;c++){var l=e[c],f=l._quid,d=l.dispose;l=i._dispose(l),l._quid=f,l.dispose=d,i._getPool.call(i,l).push(l)}r.inPool+=t,r.inQueue-=t,s.durationSamples+=t,s.durationTotal+=(new Date).getTime()-n,s.durationAverage=s.durationTotal/s.durationSamples}else{if("function"==typeof i._destroy)for(var p=0;t>p;p++)i._destroy(e[p]);e.length=0,r.inQueue-=t,r.destroyed+=t}}var n,i={interval:1e3/60,frameBudget:.5,maxPoolsize:1e3};return n=t.base.extend({metrics:null,_settings:null,_pool:null,_queue:null,_variables:null,_constructor:function(n){var r=this;r.metrics={total:0,inPool:0,inUse:0,inQueue:0,recycled:0,destroyed:0},r._settings=t["function/merge"]({},i,n),r._pool=r._initPool(),r._queue=[],r._variables={durationSamples:0,durationTotal:0,durationAverage:0},setInterval(function(){e.call(r)},r._settings.interval)},_initPool:function(){return[]},_initElement:function(e){var n=this;return e._quid=t["function/unique/uuid"](),e.dispose=function(){n.dispose(e)},n.metrics.total++,e},_getPool:function(){return this._pool},obtain:function(){var t=this,e=t._getPool.apply(t,arguments).pop();return e?(t.metrics.inPool--,t.metrics.recycled++):e=t._initElement(t._obtain.apply(t,arguments)),"function"==typeof e._obtain&&e._obtain.apply(e,arguments),t.metrics.inUse++,e},dispose:function(t){var e=this,n=e._queue;return t._quid||(t=e._initElement(t),e.metrics.inUse++),"function"==typeof t._dispose&&t._dispose(),n.push(t),e.metrics.inUse--,e.metrics.inQueue++,null}})},window);
(function(t,e){"use strict";function n(){var n=e.qoopido.initialize("pool/dom",t,arguments);return e.qoopido.shared.pool=e.qoopido.shared.pool||{},e.qoopido.shared.pool.dom=n.create(),n}"function"==typeof define&&define.amd?define(["../pool"],n):n()})(function(t,e,n,i,r){"use strict";var o;return o=t.pool.extend({_initPool:function(){return{}},_getPool:function(t){var e=this;return"string"!=typeof t&&(t=t.tagName.toLowerCase()),e._pool[t]=e._pool[t]||[]},_dispose:function(t){var e;t.parentNode&&t.parentNode.removeChild(t);for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))try{t.removeAttribute(e)}catch(n){t.property=null}return t},_obtain:function(t){return r.createElement(t)}})},window);
(function(e,t){"use strict";function n(){return t.qoopido.initialize("transport",e,arguments)}"function"==typeof define&&define.amd?define(["./base","./function/merge"],n):n()})(function(e){"use strict";var t;return t=e.base.extend({setup:function(t){var n=this;return n._settings=e["function/merge"]({},n._settings,t),n},serialize:function(e,t){var n,o,i,r=[];for(n in e)o=t?"".concat(t,"[",n,"]"):n,i=e[n],r.push("object"==typeof i?this.serialize(i,o):"".concat(encodeURIComponent(o),"=",encodeURIComponent(i)));return r.join("&")}})},window,document);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("transport/xhr",t,arguments,!0)}"function"==typeof define&&define.amd?define(["../transport","../function/merge","../function/unique/string","../url","q"],n):n()})(function(t,e,n,o,i,r){"use strict";function s(t,e,n){var o,i=this,r=i.xhr,s=i.settings;n="object"==typeof n?i.serialize(n):n,e=s.cache===!1?"".concat(e,e.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):e,e=n&&"GET"===t?"".concat(e,e.indexOf("?")>-1?"&":"?",n):e;for(o in s.xhrOptions)r[o]=s.xhrOptions[o];if(r.open(t,e,s.async,s.username,s.password),r.setRequestHeader){r.setRequestHeader("Accept",s.accept),n&&"GET"!==t&&r.setRequestHeader("Content-Type",s.contentType);for(o in s.header)r.setRequestHeader(o,s.header[o])}r.timeout=s.timeout,r.onprogress=function(t){u.call(i,t)},r.onreadystatechange=r.onload=function(){a.call(i)},r.onerror=function(){c.call(i)},r.send(n||null),i.timeout=setTimeout(function(){l.call(i)},s.timeout)}function u(t){var e=this;e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){l.call(e)},e.settings.timeout),e.dfd.notify(t)}function a(){var t=this,e=t.xhr,n=t.dfd;(e.readyState===r||4===e.readyState)&&(f.call(t),e.status===r||200===e.status?n.resolve({data:e.responseText,xhr:e}):n.reject({status:e.status,xhr:e}))}function c(){var t=this;f.call(t),t.dfd.reject()}function l(){var t=this;t.xhr.abort(),f.call(t),t.dfd.reject()}function f(){var t=this,e=t.xhr;t.timeout&&clearTimeout(t.timeout),e.onprogress=e.onreadystatechange=e.onerror=null}var d,p=o.Q||e[4],m=o.XMLHttpRequest!==r?function(e){return t.url.isLocal(e)?new o.XMLHttpRequest:o.XDomainRequest?new o.XDomainRequest:new o.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){return null}};return d=t.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(e,n,o,i){var r={};return n=t.url.resolve(n),r.url=n,r.id="".concat("xhr-",t["function/unique/string"]()),r.dfd=p.defer(),r.xhr=m(n),r.settings=t["function/merge"]({},this._settings,i),r.timeout=null,s.call(r,e.toUpperCase(),n,o),r.dfd.promise},get:function(t,e,n){return this.load("GET",t,e,n)},post:function(t,e,n){return this.load("POST",t,e,n)},put:function(t,e,n){return this.load("PUT",t,e,n)},"delete":function(t,e,n){return this.load("DELETE",t,e,n)},head:function(t,e,n){return this.load("HEAD",t,e,n)}})},window,document);
(function(t){"use strict";"function"==typeof define&&define.amd?define(t):t()})(function(){"use strict";String.prototype.ucfirst||(String.prototype.ucfirst=function(){var t=this;return t.charAt(0).toUpperCase()+t.slice(1)})});
(function(t,e){"use strict";function n(){return e.qoopido.initialize("support",t,arguments,!0)}"function"==typeof define&&define.amd?define(["./base","./polyfill/string/ucfirst","q","./pool/dom"],n):n()})(function(t,e,n,i,r,o){"use strict";var u=i.Q||e[2],s=RegExp("-([a-z])","gi"),a=RegExp("^(Moz|WebKit|Khtml|ms|O|Icab)(?=[A-Z])"),c=function(t){return t.ucfirst()},l={prefix:null,method:{},property:{},css:{},element:{},promises:{prefix:null,method:{},property:{},css:{},test:{}}};return t.base.extend({test:{},testMultiple:function(){var t,e=[],n=0;for(n;(t=arguments[n])!==o;n++)switch(typeof t){case"string":e.push(this.test[t]());break;case"boolean":var i=u.defer();t?i.resolve():i.reject(),e.push(i.promise);break;default:e.push(t)}return u.all(e)},getPrefix:function(){var t,e=l.prefix||null;if(null===e){var n=i.qoopido.shared.pool.dom.obtain("div"),r=n.style;e=!1;for(t in r)a.test(t)&&(e=t.match(a)[0]);e===!1&&"WebkitOpacity"in r&&(e="WebKit"),e===!1&&"KhtmlOpacity"in r&&(e="Khtml"),e=l.prefix=e===!1?!1:{method:e,properties:[e.toLowerCase(),e.toLowerCase().ucfirst()]},n.dispose()}return e},getMethod:function(t,e){e=e||i;var n=e.tagName,r=l.method[n]=l.method[n]||{},u=r[t]=l.method[n][t]||null;if(null===u){u=!1;var s,a,c=0,f=t.ucfirst(),p=this.getPrefix();for(s=p!==!1?(t+" "+p.method+f+" "+p.properties.join(f+" ")+f).split(" "):[t],c;(a=s[c])!==o;c++)if(e[a]!==o&&("function"==typeof e[a]||"object"==typeof e[a])){u=a;break}l.method[n][t]=u}return u},getProperty:function(t,e){e=e||i;var n=e.tagName,r=l.property[n]=l.property[n]||{},u=r[t]=l.property[n][t]||null;if(null===u){u=!1;var s,a,c=0,f=t.ucfirst(),p=this.getPrefix();for(s=p!==!1?(t+" "+p.properties.join(f+" ")+f).split(" "):[t],c;(a=s[c])!==o;c++)if(e[a]!==o){u=a;break}l.property[n][t]=u}return u},getCssProperty:function(t){t=t.replace(s,c);var e=l.css[t]||null;if(null===e){e=!1;var n,r=0,u=i.qoopido.shared.pool.dom.obtain("div"),a=t.ucfirst(),f=(this.getPrefix()||{properties:[]}).properties,p=(t+" "+f.join(a+" ")+a).split(" ");for(r;(n=p[r])!==o;r++)if(u.style[n]!==o){e=n;break}l.css[t]=e,u.dispose()}return e},supportsPrefix:function(){return!!this.getPrefix()},supportsMethod:function(t,e){return!!this.getMethod(t,e)},supportsProperty:function(t,e){return!!this.getProperty(t,e)},supportsCssProperty:function(t){return!!this.getCssProperty(t)},testPrefix:function(){var t=l.promises.prefix;if(null===t){var e=u.defer(),n=this.getPrefix();n?e.resolve(n):e.reject(),t=l.promises.prefix=e.promise}return t},testMethod:function(t,e){e=e||i;var n=e.tagName,r=l.promises.method[n]=l.promises.method[n]||{},o=r[t]=l.promises.method[n][t]||null;if(null===o){var s=u.defer(),a=this.getMethod(t,e);a?s.resolve(a):s.reject(),o=l.promises.method[n][t]=s.promise}return o},testProperty:function(t,e){e=e||i;var n=e.tagName,r=l.promises.property[n]=l.promises.property[n]||{},o=r[t]=l.promises.property[n][t]||null;if(null===o){var s=u.defer(),a=this.getProperty(t,e);a?s.resolve(a):s.reject(),o=l.promises.property[n][t]=s.promise}return o},testCssProperty:function(t){var e=l.promises.css[t]||null;if(null===e){var n=u.defer(),i=this.getCssProperty(t);i?n.resolve(i):n.reject(),e=l.promises.css[t]=n.promise}return e},addTest:function(t,e){return this.test[t]=function(){var n=l.promises.test[t]||null;if(null===n){var i=u.defer(),r=Array.prototype.slice.call(arguments);r.splice(0,0,i),e.apply(null,r),n=l.promises.test[t]=i.promise}return n}}})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("support/capability/datauri",t,arguments)}"function"==typeof define&&define.amd?define(["../../support","../../dom/element","../../pool/dom"],n):n()})(function(t,e,n,i){"use strict";return t.support.addTest("/capability/datauri",function(e){var n=t["dom/element"].create(i.qoopido.shared.pool.dom.obtain("img"));n.one("error load",function(t){"load"===t.type&&1===n.element.width&&1===n.element.height?e.resolve():e.reject(),n.element.dispose()},!1).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("support/element/canvas",t,arguments)}"function"==typeof define&&define.amd?define(["../../support","../../pool/dom"],n):n()})(function(t,e,n,i){"use strict";return t.support.addTest("/element/canvas",function(t){var e=i.qoopido.shared.pool.dom.obtain("canvas");e.getContext&&e.getContext("2d")?t.resolve():t.reject(),e.dispose()})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("support/element/canvas/todataurl",t,arguments)}"function"==typeof define&&define.amd?define(["../../../support","../canvas","../../../pool/dom"],n):n()})(function(t,e,n,i,r,o){"use strict";return t.support.addTest("/element/canvas/todataurl",function(e){t["support/element/canvas"]().then(function(){var t=i.qoopido.shared.pool.dom.obtain("canvas");t.toDataURL!==o?e.resolve():e.reject(),t.dispose()}).fail(function(){e.reject()})})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("support/element/canvas/todataurl/png",t,arguments)}"function"==typeof define&&define.amd?define(["../../../../support","../todataurl","../../../../pool/dom"],n):n()})(function(t){"use strict";return t.support.addTest("/element/canvas/todataurl/png",function(e){t["support/element/canvas/todataurl"]().then(function(){var t=window.qoopido.shared.pool.dom.obtain("canvas");0===t.toDataURL("image/png").indexOf("data:image/png")?e.resolve():e.reject(),t.dispose()}).fail(function(){e.reject()})})},window);
(function(t,e){"use strict";function n(){return e.qoopido.initialize("dom/element/shrinkimage",t,arguments)}"function"==typeof define&&define.amd?(e.JSON&&JSON.parse&&define("json",function(){return e.JSON}),define(["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr","../../pool/dom","json"],n)):n()})(function(t,e,n,i){"use strict";function r(e,n){e=t.url.resolve(h.exec(e)[1]),n=n?!0:!1;var i=this,r=t["function/merge"]({},i._settings,t.url.getParameter(e)),a=r.target||(e=e.split("?")[0]).replace(g,"".concat(".q",r.quality,".shrunk"));n||i.removeAttribute(i._settings.attribute).hide(),t.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(r.debug).then(function(){switch(typeof p[a]){case"object":p[a].one(_,function(t){o.call(i,t.data,n)}),i.emit(v);break;case"string":o.call(i,p[a],n);break;default:p[a]=c.create(a,n?null:i._element).one(w,function(t){t.type===_?(p[a]=t.data,i.emit(y),o.call(i,t.data,n)):(p[a]=e,o.call(i,e,n))},!1)}}).fail(function(){p[a]=e,o.call(i,e,n)}).done()}function o(t,e){var n=this;e?(n.element.style.backgroundImage="url("+t+")",n.emit(_),n.off()):n.one(x,function(){n.show(),n.emit(_),n.off()}).setAttribute("src",t)}function a(t){var e=this;t.get(e._url).done(function(t){try{var n=JSON.parse(t.data);n.width=parseInt(n.width,10),n.height=parseInt(n.height,10),l.call(e,n)}catch(i){e.emit(b)}},function(){e.emit(b)})}function l(t){var e,n,r=this,o=function(o){return e=i.qoopido.shared.pool.dom.obtain("canvas"),e.style.display="none",e.width=t.width,e.height=t.height,n=e.getContext("2d"),n.clearRect(0,0,t.width,t.height),n.drawImage(r.element,0,0,t.width,t.height),r.one(x,a).setAttribute("src",t.alpha),s(o)},a=function(i){var o;return n.globalCompositeOperation="xor",n.drawImage(r.element,0,0,t.width,t.height),o=e.toDataURL("image/png"),l(),r.emit(_,o),s(i)},l=function(){e&&e.dispose(),r.element._quid&&r.element.dispose&&r.element.dispose()};r.one(q,function(t){t.type===x?o.call(this,t):(l(),r.emit(b))},!1).setAttribute("src",t.main)}function s(t){return t.preventDefault(),t.stopPropagation(),!1}var u,c,f=n.pop(),d={attribute:"data-"+f,quality:80,debug:!1},p={},m=RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),h=RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),g=RegExp("\\.png$","i"),v="queued",y="cached",_="loaded",b="failed",w="".concat(_," ",b),x="load",E="error",q="".concat(x," ",E);return u=t["dom/element"].extend({_constructor:function(e,n){var i,o,a=this;u._parent._constructor.call(a,e),a._settings=n=t["function/merge"]({},d,n),i=a.getAttribute(n.attribute),o=a.element.style.backgroundImage,"IMG"===a.type&&r.call(a,i),"none"!==o&&m.test(o)&&r.call(a,o,!0)},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),c=t["dom/element"].extend({_url:null,_constructor:function(e,n){var r=this;n||(n=i.qoopido.shared.pool.dom.obtain("img")),u._parent._constructor.call(r,n),r._url=e,a.call(r,t["transport/xhr"])}}),u},window);