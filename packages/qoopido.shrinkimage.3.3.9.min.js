/*!
* Qoopido.js library v3.3.9, 2014-6-3
* https://github.com/dlueth/qoopido.js
* (c) 2014 Dirk Lueth
* Dual licensed under MIT and GPL
*/
!function(e,t){t.register?t.register("polyfill/object/defineproperty",e):(t.modules=t.modules||{})["polyfill/object/defineproperty"]=e()}(function(){"use strict";if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()){var e=Object.defineProperty,t=Object.prototype.__defineGetter__,r=Object.prototype.__defineSetter__;Object.defineProperty=function(n,o,i){if(e)try{return e(n,o,i)}catch(s){}if(n!==Object(n))throw new TypeError("Object.defineProperty called on non-object");return t&&"get"in i&&t.call(n,o,i.get),r&&"set"in i&&r.call(n,o,i.set),"value"in i&&(n[o]=i.value),n}}return Object.defineProperty},window.qoopido=window.qoopido||{}),function(e,t){if(t.register){var r=[];Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()||r.push("./defineproperty"),t.register("polyfill/object/defineproperties",e,r)}else(t.modules=t.modules||{})["polyfill/object/defineproperties"]=e()}(function(){"use strict";return Object.defineProperties||(Object.defineProperties=function(e,t){if(e!==Object(e))throw new TypeError("Object.defineProperties called on non-object");var r;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&Object.defineProperty(e,r,t[r]);return e}),Object.defineProperties},window.qoopido=window.qoopido||{}),function(e,t){if(t.register){var r=[];Object.defineProperties||r.push("./defineproperties"),t.register("polyfill/object/create",e,r)}else(t.modules=t.modules||{})["polyfill/object/create"]=e()}(function(){"use strict";return Object.create||(Object.create=function(e,t){function r(){}if("object"!=typeof e)throw new TypeError;r.prototype=e;var n=new r;if(e&&(n.constructor=r),arguments.length>1){if(t!==Object(t))throw new TypeError;Object.defineProperties(n,t)}return n}),Object.create},window.qoopido=window.qoopido||{}),function(e,t){t.register?t.register("polyfill/object/getownpropertynames",e):(t.modules=t.modules||{})["polyfill/object/getownpropertynames"]=e()}(function(){"use strict";return Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){if(e!==Object(e))throw new TypeError("Object.getOwnPropertyNames called on non-object");var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}),Object.getOwnPropertyNames},window.qoopido=window.qoopido||{}),function(e,t){t.register?t.register("polyfill/object/getownpropertydescriptor",e):(t.modules=t.modules||{})["polyfill/object/getownpropertydescriptor"]=e()}(function(){"use strict";if(!Object.getOwnPropertyDescriptor||!function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(e){return!1}}()){var e=Object.getOwnPropertyDescriptor;Object.getOwnPropertyDescriptor=function(t,r){if(t!==Object(t))throw new TypeError;try{return e.call(Object,t,r)}catch(n){}return Object.prototype.hasOwnProperty.call(t,r)?{value:t[r],enumerable:!0,writable:!0,configurable:!0}:void 0}}return Object.getOwnPropertyDescriptor},window.qoopido=window.qoopido||{}),function(e,t,r,n,o,i){"use strict";function s(e){for(var t;(t=e.replace(d,""))!==e;)e=t;return e.replace(m,"")}var a,c,u=t.shared=t.shared||{},l=t.modules=t.modules||{},p=[],f=new RegExp("^\\.+\\/"),d=new RegExp("(?:\\/|)[^\\/]*\\/\\.\\."),m=new RegExp("(^\\/)|\\.\\/","g");a=t.register=function(e,t,a,c){var p,d=e.split("/");return l[e]?l[e]:(p=function(){if(a){var p,m,h,g=d.slice(0,-1).join("/");for(p=0;(m=a[p])!==i;p++)h=f.test(m),h&&(m=s(g+"/"+m)),!l[m]&&arguments[p]&&(l[m]=arguments[p]),h&&!l[m]&&"undefined"!=typeof console&&console.error("".concat("[Qoopido.js] ",e,": Could not load dependency ",m))}return l[e]=t(l,u,d,r,n,o,i),c&&c(l[e]),l[e]},"function"==typeof define&&define.amd?a?define(a,p):define(p):p(),void 0)},c=t.registerSingleton=function(e,t,r){a(e,t,r,function(t){l[e]=t.create()})},Object.create||p.push("./polyfill/object/create"),Object.getOwnPropertyNames||p.push("./polyfill/object/getownpropertynames"),Object.getOwnPropertyDescriptor&&function(){try{return Object.getOwnPropertyDescriptor({x:0},"x"),!0}catch(e){return!1}}()||p.push("./polyfill/object/getownpropertydescriptor"),a("base",e,p)}(function(e,t,r,n,o,i,s){"use strict";function a(e){var t,r,n={},o=Object.getOwnPropertyNames(e);for(t=0;(r=o[t])!==s;t++)n[r]=Object.getOwnPropertyDescriptor(e,r);return n}function c(){"undefined"!=typeof console&&console.error("[Qoopido.js] Operation prohibited on an actual instance")}return{create:function(){var e,t=Object.create(this,a(this));return t._constructor&&(e=t._constructor.apply(t,arguments)),t.create=t.extend=c,e||t},extend:function(e){return e=e||{},e._parent=this,Object.create(this,a(e))}}},window.qoopido=window.qoopido||{},navigator,window,document),function(e){window.qoopido.register("polyfill/string/ucfirst",e)}(function(){"use strict";return String.prototype.ucfirst||(String.prototype.ucfirst=function(){var e=this;return e.charAt(0).toUpperCase()+e.slice(1)}),String.prototype.ucfirst}),function(e){window.qoopido.register("polyfill/window/getcomputedstyle",e)}(function(e,t,r,n,o){"use strict";if(o.getComputedStyle)return o.getComputedStyle;var i=new RegExp("(\\-([a-z]){1})","g"),s=function(){return arguments[2].toUpperCase()};return function(e){var t=this;return t.element=e,t.getPropertyValue=function(t){return"float"===t&&(t="styleFloat"),i.test(t)&&(t=t.replace(i,s)),e.currentStyle[t]?e.currentStyle[t]:null},t}}),function(e){window.qoopido.register("function/merge",e)}(function(e,t,r,n,o,i,s){"use strict";return function a(){var e,t,r,n,o,i=arguments[0];for(e=1;(t=arguments[e])!==s;e++)for(r in t)n=i[r],o=t[r],o!==s&&(null!==o&&"object"==typeof o?(n=o.length!==s?n&&"object"==typeof n&&n.length!==s?n:[]:n&&"object"==typeof n&&n.length===s?n:{},i[r]=a(n,o)):i[r]=o);return i}}),function(e){window.qoopido.register("function/unique/string",e)}(function(){"use strict";function e(e){var t,n="";for(e=parseInt(e,10)||12,t=0;e>t;t++)n+=r[parseInt(Math.random()*(r.length-1),10)];return n}var t={},r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return function(r){var n;do n=e(r);while("undefined"!=typeof t[n]);return t[n]=!0,n}}),function(e){window.qoopido.register("function/unique/uuid",e)}(function(){"use strict";function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,function(e){var t=16*Math.random()|0,r="x"===e?t:3&t|8;return r.toString(16)})}var t={},r=new RegExp("[xy]","g");return function(){var r;do r=e();while("undefined"!=typeof t[r]);return t[r]=!0,r}}),function(e){window.qoopido.register("proxy",e,["./base","./function/unique/uuid"])}(function(e){"use strict";return e.base.extend({_constructor:function(t,r){var n=Array.prototype.splice.call(arguments,2),o=function(){return r.apply(t,Array.prototype.slice.call(arguments,0).concat(n))};return o._quid=e["function/unique/uuid"](),o}})}),function(e){var t=["../proxy"];window.getComputedStyle||t.push("../polyfill/window/getcomputedstyle"),window.qoopido.register("dom/element",e,t)}(function(e,t,r,n,o,i,s){"use strict";function a(e){return e=e||o.event,e.target||(e.target=e.srcElement||i),3===e.target.nodeType&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e}var c,u,l,p="object",f="string",d=o.getComputedStyle||e["polyfill/window/getcomputedstyle"];return c=o.addEventListener?function(e,t){var r=this,n=r.element,o="".concat("listener[",e,"][",t._quid||t,"]");n[o]=function(e){t.call(this,a(e))},n.addEventListener(e,n[o],!1)}:function(e,t){var r,n=this,i=n.element;r="".concat("listener[",e,"][",t._quid||t,"]"),i["on"+e]!==s?(i[r]=function(e){t.call(this,a(e||o.event))},i.attachEvent("on"+e,i[r])):(e="".concat("fake[",e,"]"),i[e]=null,i[r]=function(r){r.propertyName===e&&t.call(this,a(i[e]))},i.attachEvent("onpropertychange",i[r]))},u=o.removeEventListener?function(e,t){var r=this,n=r.element,o="".concat("listener[",e,"][",t._quid||t,"]");n.removeEventListener(e,n[o],!1),delete n[o]}:function(e,t){var r=this,n=r.element,o="".concat("listener[",e,"][",t._quid||t,"]");n["on"+e]!==s?n.detachEvent("on"+e,n[o]):n.detachEvent("onpropertychange",n[o]),delete n[o]},l=i.createEvent?function(e,t){var r=this,n=r.element,o=i.createEvent("HTMLEvents");o.initEvent(e,!0,!0),o.data=t,n.dispatchEvent(o)}:function(e,t){var r=this,n=r.element,o=i.createEventObject();o.type=o.eventType=e,o.data=t;try{n.fireEvent("on"+o.eventType,o)}catch(a){var c="".concat("fake[",e,"]");n[c]!==s&&(n[c]=o)}},e.base.extend({type:null,element:null,listener:null,_constructor:function(e){var t=this;if(!e)throw new Error("Missing element argument");t.type=e.tagName,t.element=e,t.listener={}},getAttribute:function(e){if(e&&typeof e===f){var t=this;return e=e.split(" "),1===e.length?t.element.getAttribute(e[0]):t.getAttributes(e)}},getAttributes:function(e){var t=this,r={};if(e&&(e=typeof e===f?e.split(" "):e,typeof e===p&&e.length)){var n,o;for(n=0;(o=e[n])!==s;n++)r[o]=t.element.getAttributes(o)}return r},setAttribute:function(e,t){var r=this;return e&&typeof e===f&&r.element.setAttribute(e,t),r},setAttributes:function(e){var t=this;if(e&&typeof e===p&&!e.length){var r;for(r in e)t.element.setAttribute(r,e[r])}return t},removeAttribute:function(e){var t=this;return e&&typeof e===f&&(e=e.split(" "),1===e.length?t.element.removeAttribute(e[0]):t.removeAttributes(e)),t},removeAttributes:function(e){var t=this;if(e&&(e=typeof e===f?e.split(" "):e,typeof e===p&&e.length)){var r,n;for(r=0;(n=e[r])!==s;r++)t.element.removeAttribute(n)}return t},getStyle:function(e){if(e&&typeof e===f){var t=this;return e=e.split(" "),1===e.length?d(t.element,null).getPropertyValue(e[0]):t.getStyles(e)}},getStyles:function(e){var t=this,r={};if(e&&(e=typeof e===f?e.split(" "):e,typeof e===p&&e.length)){var n,o;for(n=0;(o=e[n])!==s;n++)r[o]=d(t.element,null).getPropertyValue(o)}return r},setStyle:function(e,t){var r=this;return e&&typeof e===f&&(r.element.style[e]=t),r},setStyles:function(e){var t=this;if(e&&typeof e===p&&!e.length){var r;for(r in e)t.element.style[r]=e[r]}return t},isVisible:function(){var e=this.element;return!(e.offsetWidth<=0&&e.offsetHeight<=0)},hasClass:function(e){return new RegExp("(?:^|\\s)"+e+"(?:\\s|$)").test(this.element.className)},addClass:function(e){var t,r=this;return r.hasClass(e)||(t=r.element.className.split(" "),t.push(e),r.element.className=t.join(" ")),r},removeClass:function(e){var t=this;return t.hasClass(e)&&(t.element.className=t.element.className.replace(new RegExp("(?:^|\\s)"+e+"(?!\\S)"),"")),t},toggleClass:function(e){var t=this;return t.hasClass(e)?t.removeClass(e):t.addClass(e),t},prepend:function(e){var t=this,r=t.element;return e=e.element||e,r.firstChild?r.insertBefore(e,r.firstChild):t.append(e),t},append:function(e){var t=this;return t.element.appendChild(e.element||e),t},replaceWith:function(e){var t=this,r=t.element;return e=e.element||e,r.parentNode.replaceChild(e,r),t},prependTo:function(e){var t=this,r=t.element;return(e=e.element||e).firstChild?e.insertBefore(r,e.firstChild):t.appendTo(e),t},appendTo:function(e){var t=this;return(e.element||e).appendChild(t.element),t},insertBefore:function(e){var t=this,r=t.element;return(e=e.element||e).parentNode.insertBefore(r,e),t},insertAfter:function(e){var t=this,r=t.element;return(e=e.element||e).nextSibling?e.parentNode.insertBefore(r,e.nextSibling):t.appendTo(e.parentNode),t},replace:function(e){var t=this,r=t.element;return(e=e.element||e).parentNode.replaceChild(r,e),t},remove:function(){var e=this,t=e.element;return t.parentNode.removeChild(t),e},on:function(e,t){var r,n,o=this;for(e=e.split(" "),r=0;(n=e[r])!==s;r++)(o.listener[n]=o.listener[n]||[]).push(t),c.call(o,n,t);return o},one:function(t,r,n){n=n!==!1;var o=this,i=e.proxy.create(o,function(e){o.off(n===!0?e.type:t,i),r.call(o,e)});return o.on(t,i),o},off:function(e,t){var r,n,o,i,a=this;if(e)for(e=e.split(" "),r=0;(n=e[r])!==s;r++)if(a.listener[n]=a.listener[n]||[],t)for(o=0;(i=a.listener[n][o])!==s;o++)i===t&&(a.listener[n].splice(o,1),u.call(a,n,i),o--);else for(;a.listener[n].length>0;)u.call(a,n,a.listener[n].pop());else for(n in a.listener)for(;a.listener[n].length>0;)u.call(a,n,a.listener[n].pop());return a},emit:function(e,t){var r=this;return l.call(r,e,t),r}})}),function(e){window.qoopido.registerSingleton("url",e,["./base"])}(function(e,t,r,n,o,i){"use strict";function s(e){var t=i.createElement("a");return t.href=e||"",t}var a,c,u=new RegExp("[?&]?([^=]+)=([^&]*)","g");try{a=location}catch(l){a=s()}return c=new RegExp("".concat("^",a.protocol,"//",a.hostname),"i"),e.base.extend({resolve:function(e){return s(e).href},redirect:function(e,t){t=t||o,t.location.href=this.resolve(e)},getParameter:function(e){for(var t,r={},n=s(e).search.split("+").join(" ");t=u.exec(n);)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r},isLocal:function(e){return c.test(this.resolve(e))}})}),function(e){var t=["./base","q"];String.prototype.ucfirst||t.push("./polyfill/string/ucfirst"),window.qoopido.registerSingleton("support",e,t)}(function(e,t,r,n,o,i,s){"use strict";var a=e.q||o.Q,c=new RegExp("^(Moz|WebKit|Khtml|ms|O|Icab)(?=[A-Z])"),u=new RegExp("-([a-z])","gi"),l=new RegExp("([A-Z])","g"),p=function(){return arguments[1].ucfirst()},f={prefix:null,method:{},property:{},css:{},element:{},promises:{prefix:null,method:{},property:{},css:{},test:{}}};return e.base.extend({test:{},pool:t.pool&&t.pool.dom,testMultiple:function(){var e,t=[],r=0;for(r;(e=arguments[r])!==s;r++)switch(typeof e){case"string":t.push(this.test[e]());break;case"boolean":var n=a.defer();e?n.resolve():n.reject(),t.push(n.promise);break;default:t.push(e)}return a.all(t)},getPrefix:function(){var e,t=this,r=f.prefix||null;if(null===r){var n=t.pool?t.pool.obtain("div"):i.createElement("div"),o=n.style;r=!1;for(e in o)c.test(e)&&(r=e.match(c)[0]);r===!1&&"WebkitOpacity"in o&&(r="WebKit"),r===!1&&"KhtmlOpacity"in o&&(r="Khtml"),r=f.prefix=r===!1?!1:[r.toLowerCase(),r.toLowerCase().ucfirst(),r],n.dispose&&n.dispose()}return r},getMethod:function(e,t){t=t||o;var r=t.tagName,n=f.method[r]=f.method[r]||{},i=n[e]=f.method[r][e]||null;if(null===i){i=!1;var a,c,u=0,l=e.ucfirst(),p=this.getPrefix();for(a=p!==!1?(e+" "+p.join(l+" ")+l).split(" "):[e],u;(c=a[u])!==s;u++)if(t[c]!==s&&("function"==typeof t[c]||"object"==typeof t[c])){i=c;break}f.method[r][e]=i}return i},getProperty:function(e,t){t=t||o;var r=t.tagName,n=f.property[r]=f.property[r]||{},i=n[e]=f.property[r][e]||null;if(null===i){i=!1;var a,c,u=0,l=e.ucfirst(),p=this.getPrefix();for(a=p!==!1?(e+" "+p.join(l+" ")+l).split(" "):[e],u;(c=a[u])!==s;u++)if(t[c]!==s){i=c;break}f.property[r][e]=i}return i},getCssProperty:function(e){e=e.replace(u,p);var t=this,r=f.css[e]||null;if(null===r){r=!1;var n,o=0,a=t.pool?t.pool.obtain("div"):i.createElement("div"),c=e.ucfirst(),d=this.getPrefix()||[],m=(e+" "+d.join(c+" ")+c).split(" "),h="";for(o;(n=m[o])!==s;o++)if(a.style[n]!==s){r=n,o>0&&(h="-");break}f.css[e]=r!==!1?[h+r.replace(l,"-$1").toLowerCase(),r]:!1,a.dispose&&a.dispose()}return r},supportsPrefix:function(){return!!this.getPrefix()},supportsMethod:function(e,t){return!!this.getMethod(e,t)},supportsProperty:function(e,t){return!!this.getProperty(e,t)},supportsCssProperty:function(e){return!!this.getCssProperty(e)},testPrefix:function(){var e=f.promises.prefix;if(null===e){var t=a.defer(),r=this.getPrefix();r?t.resolve(r):t.reject(),e=f.promises.prefix=t.promise}return e},testMethod:function(e,t){t=t||o;var r=t.tagName,n=f.promises.method[r]=f.promises.method[r]||{},i=n[e]=f.promises.method[r][e]||null;if(null===i){var s=a.defer(),c=this.getMethod(e,t);c?s.resolve(c):s.reject(),i=f.promises.method[r][e]=s.promise}return i},testProperty:function(e,t){t=t||o;var r=t.tagName,n=f.promises.property[r]=f.promises.property[r]||{},i=n[e]=f.promises.property[r][e]||null;if(null===i){var s=a.defer(),c=this.getProperty(e,t);c?s.resolve(c):s.reject(),i=f.promises.property[r][e]=s.promise}return i},testCssProperty:function(e){var t=f.promises.css[e]||null;if(null===t){var r=a.defer(),n=this.getCssProperty(e);n?r.resolve(n):r.reject(),t=f.promises.css[e]=r.promise}return t},addTest:function(e,t){return this.test[e]=function(){var r=f.promises.test[e]||null;if(null===r){var n=a.defer(),o=Array.prototype.slice.call(arguments);o.splice(0,0,n),t.apply(null,o),r=f.promises.test[e]=n.promise}return r}}})}),function(e){window.qoopido.register("support/capability/datauri",e,["../../support","../../dom/element"])}(function(e,t,r,n,o,i){"use strict";var s=e.support;return s.addTest("/capability/datauri",function(t){var r=e["dom/element"].create(s.pool?s.pool.obtain("img"):i.createElement("img"));r.one("error load",function(e){"load"===e.type&&1===r.element.width&&1===r.element.height?t.resolve():t.reject(),r.element.dispose&&r.element.dispose()},!1).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})}),function(e){window.qoopido.register("support/element/canvas",e,["../../support"])}(function(e,t,r,n,o,i){"use strict";var s=e.support;return s.addTest("/element/canvas",function(e){var t=s.pool?s.pool.obtain("canvas"):i.createElement("canvas");t.getContext&&t.getContext("2d")?e.resolve():e.reject(),t.dispose&&t.dispose()})}),function(e){window.qoopido.register("support/element/canvas/todataurl",e,["../../../support","../canvas"])}(function(e,t,r,n,o,i,s){"use strict";var a=e.support;return a.addTest("/element/canvas/todataurl",function(t){e["support/element/canvas"]().then(function(){var e=a.pool?a.pool.obtain("canvas"):i.createElement("canvas");e.toDataURL!==s?t.resolve():t.reject(),e.dispose&&e.dispose()},function(){t.reject()}).done()})}),function(e){window.qoopido.register("support/element/canvas/todataurl/png",e,["../../../../support","../todataurl"])}(function(e,t,r,n,o,i){"use strict";var s=e.support;return s.addTest("/element/canvas/todataurl/png",function(t){e["support/element/canvas/todataurl"]().then(function(){var e=s.pool?s.pool.obtain("canvas"):i.createElement("canvas");0===e.toDataURL("image/png").indexOf("data:image/png")?t.resolve():t.reject(),e.dispose&&e.dispose()},function(){t.reject()}).done()})}),function(e){window.qoopido.register("transport",e,["./base","./function/merge"])}(function(e){"use strict";var t;return t=e.base.extend({setup:function(t){var r=this;return r._settings=e["function/merge"]({},r._settings,t),r},serialize:function(e,t){var r,n,o,i=[];for(r in e)n=t?"".concat(t,"[",r,"]"):r,o=e[r],i.push("object"==typeof o?this.serialize(o,n):"".concat(encodeURIComponent(n),"=",encodeURIComponent(o)));return i.join("&")}})},window,document),function(e){window.qoopido.registerSingleton("transport/xhr",e,["../transport","../function/merge","../function/unique/string","../url","q"])}(function(e,t,r,n,o,i,s){"use strict";function a(e,t,r){var n,o=this,i=o.xhr,s=o.settings;r=r&&"object"==typeof r?o.serialize(r):r,t=s.cache===!1?"".concat(t,t.indexOf("?")>-1?"&":"?","_="+(new Date).getTime()):t,t=r&&"GET"===e?"".concat(t,t.indexOf("?")>-1?"&":"?",r):t;for(n in s.xhrOptions)i[n]=s.xhrOptions[n];if(i.open(e,t,s.async,s.username,s.password),i.setRequestHeader){i.setRequestHeader("Accept",s.accept),r&&"GET"!==e&&i.setRequestHeader("Content-Type",s.contentType);for(n in s.header)i.setRequestHeader(n,s.header[n])}i.timeout=s.timeout,i.onprogress=function(e){c.call(o,e)},i.onreadystatechange=i.onload=function(){u.call(o)},i.onerror=function(){l.call(o)},i.send(r||null),o.timeout=setTimeout(function(){p.call(o)},s.timeout)}function c(e){var t=this;t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(function(){p.call(t)},t.settings.timeout),t.dfd.notify(e)}function u(){var e=this,t=e.xhr,r=e.dfd;(t.readyState===s||4===t.readyState)&&(f.call(e),t.status===s||200===t.status?r.resolve({data:t.responseText,xhr:t}):r.reject({status:t.status,xhr:t}))}function l(){var e=this;f.call(e),e.dfd.reject()}function p(){var e=this;e.xhr.abort(),f.call(e),e.dfd.reject()}function f(){var e=this,t=e.xhr;e.timeout&&clearTimeout(e.timeout),t.onprogress=t.onreadystatechange=t.onerror=null}var d,m=e.q||o.Q,h="undefined"!=typeof o.XMLHttpRequest?function(t){return e.url.isLocal(t)?new o.XMLHttpRequest:o.XDomainRequest?new o.XDomainRequest:new o.XMLHttpRequest}:function(){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return null}};return d=e.transport.extend({_settings:{accept:"*/*",timeout:5e3,async:!0,cache:!1,header:{},username:null,password:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8 ",xhrOptions:{}},load:function(t,r,n,o){var i={};return r=e.url.resolve(r),i.url=r,i.id="".concat("xhr-",e["function/unique/string"]()),i.dfd=m.defer(),i.xhr=h(r),i.settings=e["function/merge"]({},this._settings,o),i.timeout=null,a.call(i,t.toUpperCase(),r,n),i.dfd.promise},get:function(e,t,r){return this.load("GET",e,t,r)},post:function(e,t,r){return this.load("POST",e,t,r)},put:function(e,t,r){return this.load("PUT",e,t,r)},"delete":function(e,t,r){return this.load("DELETE",e,t,r)},head:function(e,t,r){return this.load("HEAD",e,t,r)}})},window,document),function(e){var t=["../element","../../proxy","../../function/merge","../../url","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png","../../transport/xhr"];window.JSON&&window.JSON.parse||t.push("json"),window.qoopido.register("dom/element/shrinkimage",e,t)}(function(e,t,r,n,o,i){"use strict";function s(t,r){t=e.url.resolve(w.exec(t)[1]),r=r?!0:!1;var n=this,o=e["function/merge"]({},n._settings,e.url.getParameter(t)),i=o.target||(t=t.split("?")[0]).replace(b,"".concat(".q",o.quality,".shrunk"));r||n.removeAttribute(n._settings.attribute).hide(),e.support.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(o.debug).then(function(){switch(typeof y[i]){case"object":y[i].one(O,function(e){a.call(n,e.data,r)}),n.emit(x);break;case"string":a.call(n,y[i],r);break;default:y[i]=f.create(i,r?null:n._element).one(P,function(e){e.type===O?(y[i]=e.data,n.emit(j),a.call(n,e.data,r)):(y[i]=t,a.call(n,t,r))},!1)}}).fail(function(){y[i]=t,a.call(n,t,r)}).done()}function a(e,t){var r=this;t?(r.setStyle("backgroundImage","url("+e+")"),r.emit(O),r.off()):r.one(q,function(){r.show(),r.emit(O),r.off()}).setAttribute("src",e)}function c(e){var t=this;e.get(t._url).then(function(e){try{var r=d.parse(e.data);r.width=parseInt(r.width,10),r.height=parseInt(r.height,10),u.call(t,r)}catch(n){t.emit(E)}},function(){t.emit(E)}).done()}function u(e){var r,n,o=this,s=function(s){return r=g?t.pool.dom.obtain("canvas"):i.createElement("canvas"),r.style.display="none",r.width=e.width,r.height=e.height,n=r.getContext("2d"),n.clearRect(0,0,e.width,e.height),n.drawImage(o.element,0,0,e.width,e.height),o.one(q,a).setAttribute("src",e.alpha),l(s)},a=function(t){var i;return n.globalCompositeOperation="xor",n.drawImage(o.element,0,0,e.width,e.height),i=r.toDataURL("image/png"),c(),o.emit(O,i),l(t)},c=function(){r&&r.dispose&&r.dispose(),o.element.dispose&&o.element.dispose()};o.one(C,function(e){e.type===q?s.call(this,e):(c(),o.emit(E))},!1).setAttribute("src",e.main)}function l(e){return e.preventDefault(),e.stopPropagation(),!1}var p,f,d=e.json||o.JSON,m=r.pop(),h={attribute:"data-"+m,quality:80,debug:!1},g=t.pool&&t.pool.dom,y={},v=new RegExp('^url\\x28"{0,1}data:image/shrink,(.+?)"{0,1}\\x29$',"i"),w=new RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),b=new RegExp("\\.png$","i"),x="queued",j="cached",O="loaded",E="failed",P="".concat(O," ",E),q="load",A="error",C="".concat(q," ",A);return p=e["dom/element"].extend({_constructor:function(t,r){var n,o,i=this;p._parent._constructor.call(i,t),i._settings=r=e["function/merge"]({},h,r),n=i.getAttribute(r.attribute),o=i.getStyle("backgroundImage"),"IMG"===i.type&&s.call(i,n),"none"!==o&&v.test(o)&&s.call(i,o,!0)},hide:function(){this.setStyles({visibility:"hidden",opacity:0})},show:function(){this.setStyles({visibility:"",opacity:""})}}),f=e["dom/element"].extend({_url:null,_constructor:function(r,n){var o=this;n||(n=g?t.pool.dom.obtain("img"):i.createElement("img")),f._parent._constructor.call(o,n),o._url=r,c.call(o,e["transport/xhr"])}}),p},window);